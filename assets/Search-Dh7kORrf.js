import{d as V,t as D,k as r,ap as H,aq as j,X as q,ar as R,c as O,B as K,H as W,u as G,F as A,G as J,r as B,x as Q,o as X,w as Y,a3 as S,R as v,L,M as g,U as Z,V as ee,K as E,T as z,as as te,J as d,N as T,O as ae,$ as oe,ad as ne,ae as P,W as se,_ as ce}from"./index-COLuSNnH.js";import{E as le}from"./index-7ADYuEsa.js";import"./index-BR0IqM1Y.js";import{f as M,F as re}from"./index-BsOY-DgV.js";import{N as ie}from"./index-DtBFF6eJ.js";import{u as ue}from"./fund-qjlmdvOA.js";import{searchFund as de}from"./fund-BsJItZTy.js";import{fetchFundEstimateFast as fe}from"./fundFast-BTB3GdVE.js";import{u as me}from"./use-id-Bb8U-BO_.js";import"./storage-BvZjhTaj.js";const[he,$]=O("tag"),pe={size:String,mark:Boolean,show:D,type:R("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var _e=V({name:he,props:pe,emits:["close"],setup(a,{slots:n,emit:s}){const m=l=>{l.stopPropagation(),s("close",l)},i=()=>a.plain?{color:a.textColor||a.color,borderColor:a.color}:{color:a.textColor,background:a.color},c=()=>{var l;const{type:h,mark:p,plain:I,round:x,size:_,closeable:k}=a,y={mark:p,plain:I,round:x};_&&(y[_]=_);const t=k&&r(q,{name:"cross",class:[$("close"),j],onClick:m},null);return r("span",{style:i(),class:$([y,h])},[(l=n.default)==null?void 0:l.call(n),t])};return()=>r(H,{name:a.closeable?"van-fade":void 0},{default:()=>[a.show?c():null]})}});const ve=K(_e),[ge,w,ke]=O("search"),ye=W({},M,{label:String,shape:R("square"),leftIcon:R("search"),clearable:D,actionText:String,background:String,showAction:Boolean});var Ce=V({name:ge,props:ye,emits:["blur","focus","clear","search","cancel","clickInput","clickLeftIcon","clickRightIcon","update:modelValue"],setup(a,{emit:n,slots:s,attrs:m}){const i=me(),c=B(),l=()=>{s.action||(n("update:modelValue",""),n("cancel"))},h=e=>{e.keyCode===13&&(Q(e),n("search",a.modelValue))},p=()=>a.id||`${i}-input`,I=()=>{if(s.label||a.label)return r("label",{class:w("label"),for:p(),"data-allow-mismatch":"attribute"},[s.label?s.label():a.label])},x=()=>{if(a.showAction){const e=a.actionText||ke("cancel");return r("div",{class:w("action"),role:"button",tabindex:0,onClick:l},[s.action?s.action():e])}},_=()=>{var e;return(e=c.value)==null?void 0:e.blur()},k=()=>{var e;return(e=c.value)==null?void 0:e.focus()},y=e=>n("blur",e),t=e=>n("focus",e),o=e=>n("clear",e),C=e=>n("clickInput",e),F=e=>n("clickLeftIcon",e),f=e=>n("clickRightIcon",e),u=Object.keys(M),b=()=>{const e=W({},m,A(a,u),{id:p()}),N=U=>n("update:modelValue",U);return r(re,J({ref:c,type:"search",class:w("field",{"with-message":e.errorMessage}),border:!1,labelAlign:"left",onBlur:y,onFocus:t,onClear:o,onKeypress:h,onClickInput:C,onClickLeftIcon:F,onClickRightIcon:f,"onUpdate:modelValue":N},e),A(s,["left-icon","right-icon"]))};return G({focus:k,blur:_}),()=>{var e;return r("div",{class:w({"show-action":a.showAction}),style:{background:a.background}},[(e=s.left)==null?void 0:e.call(s),r("div",{class:w("content",a.shape)},[I(),b()]),x()])}}});const be=K(Ce),Ie={class:"search-page"},xe={key:0,class:"searching-text"},we={class:"search-results"},Fe=["onClick"],Se={class:"fund-info"},Te={class:"fund-name"},Be={class:"fund-meta"},Ne={class:"fund-change-col"},Ee={key:1,class:"fund-change empty"},ze={class:"fund-action"},Re={key:1,class:"search-tip"},Ve=V({__name:"Search",setup(a){const n=se(),s=te(),m=ue(),i=B("");X(()=>{const t=s.query.q;t&&(i.value=t,p(t))});const c=B([]),l=B(!1);let h=null;Y(i,t=>{if(h&&clearTimeout(h),!t.trim()){c.value=[];return}h=setTimeout(()=>{p(t)},300)});async function p(t){if(t.trim()){l.value=!0;try{const o=await de(t,30);c.value=o;const C=["期货","QDII","FOF","联接","其他"];o.filter(f=>!C.some(u=>f.type.includes(u)||f.name.includes(u))).slice(0,10).forEach(async f=>{try{const u=await fe(f.code);if(u?.gszzl){const b=c.value.findIndex(e=>e.code===f.code);b!==-1&&(c.value[b].gszzl=u.gszzl)}}catch{}})}catch{S("搜索失败")}finally{l.value=!1}}}function I(t){if(!t)return"";const o=parseFloat(t);return isNaN(o)?"":`${o>=0?"+":""}${o.toFixed(2)}%`}function x(t){if(!t)return"";const o=parseFloat(t);return isNaN(o)?"":o>=0?"up":"down"}async function _(t){if(m.isFundInWatchlist(t.code)){S("已在自选中");return}ne({message:"添加中...",forbidClick:!0});try{await m.addFund(t.code,t.name),P(),S("添加成功")}catch{P(),S("添加失败")}}function k(){n.back()}function y(t){return m.isFundInWatchlist(t)}return(t,o)=>{const C=ie,F=be,f=ve,u=q,b=le;return d(),v("div",Ie,[r(C,{title:"搜索基金","left-arrow":"",onClickLeft:k},{right:L(()=>[l.value?(d(),v("span",xe,"搜索中...")):z("",!0)]),_:1}),r(F,{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=e=>i.value=e),placeholder:"输入基金代码或名称","show-action":"",autofocus:"",onCancel:k},null,8,["modelValue"]),g("div",we,[(d(!0),v(Z,null,ee(c.value,e=>(d(),v("div",{key:e.code,class:"fund-item",onClick:N=>_(e)},[g("div",Se,[g("div",Te,T(e.name),1),g("div",Be,T(e.code)+" · "+T(e.type),1)]),g("div",Ne,[e.gszzl?(d(),v("span",{key:0,class:ae(["fund-change",x(e.gszzl)])},T(I(e.gszzl)),3)):(d(),v("span",Ee,"--"))]),g("div",ze,[y(e.code)?(d(),E(f,{key:0,type:"success",size:"medium"},{default:L(()=>[...o[1]||(o[1]=[oe("已添加",-1)])]),_:1})):(d(),E(u,{key:1,name:"add-o",size:"22",color:"#1989fa"}))])],8,Fe))),128)),i.value&&c.value.length===0&&!l.value?(d(),E(b,{key:0,image:"search",description:"未找到相关基金"})):z("",!0),i.value?z("",!0):(d(),v("div",Re,[r(u,{name:"info-o"}),o[2]||(o[2]=g("span",null,"输入基金代码（如 001186）或名称搜索",-1))]))])])}}}),Ue=ce(Ve,[["__scopeId","data-v-8c14c1ec"]]);export{Ue as default};
