let f=null,m=[];function C(){window.jsonpgz||(window.jsonpgz=c=>{const o=m.findIndex(n=>n.code===c.fundcode);if(o!==-1&&m[o]){const n=m[o];clearTimeout(n.timeout),m.splice(o,1),n.resolve(c)}})}function S(c){return C(),new Promise((o,n)=>{const s=`fund_${c}_${Date.now()}`,r=setTimeout(()=>{a();const e=m.findIndex(i=>i.code===c);e!==-1&&m.splice(e,1),n(new Error(`请求超时: ${c}`))},1e4);m.push({code:c,resolve:o,reject:n,timeout:r});function a(){const e=document.getElementById(s);e&&document.body.removeChild(e)}const t=document.createElement("script");t.id=s,t.src=`https://fundgz.1234567.com.cn/js/${c}.js?rt=${Date.now()}`,t.onerror=()=>{a();const e=m.findIndex(i=>i.code===c);e!==-1&&m[e]&&(clearTimeout(m[e].timeout),m.splice(e,1)),n(new Error(`请求失败: ${c}`))},t.onload=()=>{setTimeout(a,100)},document.body.appendChild(t)})}async function N(c){const o=c.map(n=>S(n).catch(()=>null));return Promise.all(o)}async function T(){if(f)return f;const c=["./fund-list.json","/fund-list.json","fund-list.json"];for(const o of c)try{const n=await fetch(o);if(!n.ok)continue;const s=await n.json();if(Array.isArray(s)&&s.length>0)return f=s,console.log(`[Fund API] 加载基金列表成功 (${o}): ${f.length} 只`),f}catch{console.log(`[Fund API] 路径 ${o} 加载失败，尝试下一个`)}return console.error("[Fund API] 所有本地路径加载失败，回退到远程"),k()}async function k(){return new Promise((c,o)=>{const n=`fundlist_${Date.now()}`,s=setTimeout(()=>{r(),o(new Error("获取基金列表超时"))},3e4);window.r=null;function r(){clearTimeout(s);const t=document.getElementById(n);t&&document.body.removeChild(t)}const a=document.createElement("script");a.id=n,a.src=`https://fund.eastmoney.com/js/fundcode_search.js?rt=${Date.now()}`,a.onload=()=>{r();const t=window.r;if(!t||!Array.isArray(t)){o(new Error("基金列表数据格式错误"));return}f=t.map(e=>({code:e[0]||"",pinyin:e[1]||"",name:e[2]||"",type:e[3]||""})),c(f)},a.onerror=()=>{r(),o(new Error("获取基金列表失败"))},document.body.appendChild(a)})}async function x(c,o=50){const n=await T();if(!c.trim())return[];const s=c.toLowerCase().trim(),a={半导体:["半导体","芯片","集成电路","科技","电子","IC","晶圆"],软件开发:["软件","计算机","信息技术","科技","云计算","数字"],计算机:["计算机","软件","信息","科技","数据","互联网"],人工智能:["人工智能","AI","智能","机器人","科技","算力"],云计算:["云计算","云","数据中心","大数据","科技"],大数据:["大数据","数据","云","信息","科技"],物联网:["物联网","IOT","智能","信息","科技"],网络安全:["网络安全","安全","信息安全","科技"],通信设备:["通信","5G","设备","网络","互联网","信息","电信","光纤","光缆","基站","卫星","移动","联通","电信运营"],消费电子:["消费电子","电子","智能","手机","科技"],电子元件:["电子","元件","元器件","科技","半导体"],白酒:["白酒","酒","消费","食品饮料","茅台"],食品饮料:["食品","饮料","消费","酒","乳业","调味品"],家用电器:["家电","电器","消费","家居","智能家居"],纺织服装:["纺织","服装","消费","服饰","鞋"],商业零售:["零售","商业","消费","百货","超市","电商"],电商:["电商","电子商务","互联网","消费","零售"],旅游酒店:["旅游","酒店","餐饮","消费","休闲","服务","景区","度假","民宿","航空","出行","文旅","免税"],餐饮:["餐饮","食品","消费","酒店"],教育:["教育","培训","学校","消费"],美容护理:["美容","护理","化妆品","消费","医美"],银行:["银行","金融","理财"],证券:["证券","券商","金融","投资"],保险:["保险","金融","寿险"],多元金融:["金融","信托","租赁","投资"],医药生物:["医药","生物","医疗","健康","制药","创新药"],中药:["中药","医药","中医","健康"],医疗器械:["医疗器械","器械","医疗","医药","健康"],医疗服务:["医疗","医院","健康","医药","服务"],创新药:["创新药","医药","生物","制药"],新能源:["新能源","光伏","锂电","风电","储能","电池","太阳能","清洁能源"],光伏:["光伏","太阳能","新能源","组件"],锂电池:["锂电","电池","新能源","储能","动力电池"],风电:["风电","风能","新能源","风机"],储能:["储能","电池","新能源","能源"],氢能源:["氢能","燃料电池","新能源","氢"],汽车:["汽车","新能源车","智能汽车","车","整车","零部件"],新能源汽车:["新能源车","电动车","汽车","智能汽车"],机械设备:["机械","设备","制造","工程机械","自动化"],电气设备:["电气","设备","电力","输配电"],工程机械:["工程机械","机械","挖掘机","起重机"],军工:["军工","国防","航空","航天","军民融合","船舶"],航空航天:["航空","航天","飞机","军工","卫星"],船舶:["船舶","航运","造船","军工","海洋"],钢铁:["钢铁","钢","金属","有色"],有色金属:["有色","金属","铜","铝","锂","稀土","黄金"],煤炭:["煤炭","能源","煤","焦炭"],石油石化:["石油","石化","化工","油气","能源"],化工:["化工","化学","材料","石化"],电子化学品:["电子","化学","化工","材料","新材料","特种","精细化工","半导体材料","光刻胶","电解液","正极","负极"],基础化学:["化学","化工","基础化工"],房地产:["房地产","地产","房产","建筑","基建","物业"],建筑:["建筑","基建","工程","建材","房地产"],建材:["建材","水泥","玻璃","建筑","装修"],装修装饰:["装修","装饰","建材","家居","家装","家电","地产","建筑","房地产","基建"],基建:["基建","基础设施","建筑","工程","铁路","公路"],港口航运:["港口","航运","船舶","物流","海运"],航空机场:["航空","机场","飞机","民航"],铁路公路:["铁路","公路","高铁","交通"],物流:["物流","快递","仓储","供应链","运输"],电力:["电力","电网","发电","能源","公用事业"],水务:["水务","水利","供水","环保","公用事业"],燃气:["燃气","天然气","能源","公用事业"],环保:["环保","环境","污染治理","绿色","碳中和"],传媒:["传媒","媒体","广告","影视","文化"],游戏:["游戏","网游","手游","娱乐","互联网"],影视:["影视","电影","电视","娱乐","传媒"],广告:["广告","营销","传媒","互联网"],农牧饲渔:["农业","养殖","畜牧","渔业","饲料","农产品","种植","粮食","猪","鸡","生猪","肉鸡","水产","牧业","兽药","动保","种子","化肥","农药"],种植业:["种植","农业","粮食","农产品","种子"],养殖业:["养殖","畜牧","猪","鸡","农业"],造纸印刷:["造纸","印刷","纸业","包装","纸","林业","木材","森林","浆纸","纸板","出版"],纺织:["纺织","服装","棉","丝绸"],贵金属:["贵金属","黄金","白银","金","银"],稀土:["稀土","稀有金属","有色"]}[s];let t=n.filter(e=>e.code.includes(s)||e.name.toLowerCase().includes(s)||e.pinyin.toLowerCase().includes(s));if(a){const e=n.filter(d=>{const l=d.name.toLowerCase();return a.some(u=>l.includes(u.toLowerCase()))}),i=new Set(t.map(d=>d.code));e.forEach(d=>{i.has(d.code)||(t.push(d),i.add(d.code))})}if(t.length<10&&s.length>=2&&!a){const e=s.split(""),i=n.filter(l=>{const u=l.name.toLowerCase();return e.filter(h=>u.includes(h)).length>=Math.min(2,e.length)}),d=new Set(t.map(l=>l.code));i.forEach(l=>{d.has(l.code)||(t.push(l),d.add(l.code))})}return t.slice(0,o)}async function b(c,o=30){return new Promise((n,s)=>{const r=`lsjz_${Date.now()}_${Math.random().toString(36).slice(2)}`,a=setTimeout(()=>{t(),s(new Error("获取历史净值超时"))},15e3);window[r]=i=>{if(t(),!i||!i.Data||!i.Data.LSJZList){n([]);return}const d=i.Data.LSJZList.map(l=>({date:l.FSRQ,netValue:parseFloat(l.DWJZ)||0,totalValue:parseFloat(l.LJJZ)||0,changeRate:parseFloat(l.JZZZL)||0}));n(d)};function t(){clearTimeout(a),delete window[r];const i=document.getElementById(r);i&&document.body.removeChild(i)}const e=document.createElement("script");e.id=r,e.src=`https://api.fund.eastmoney.com/f10/lsjz?callback=${r}&fundCode=${c}&pageIndex=1&pageSize=${o}&_=${Date.now()}`,e.onerror=()=>{t(),s(new Error("获取历史净值失败"))},document.body.appendChild(e)})}async function A(c){return new Promise((o,n)=>{const s=`jjcc_${Date.now()}_${Math.random().toString(36).slice(2)}`,r=setTimeout(()=>{a(),n(new Error("获取重仓股超时"))},15e3);window[s]=e=>{if(a(),!e||!e.content){o([]);return}const i=R(e.content);o(i)};function a(){clearTimeout(r),delete window[s];const e=document.getElementById(s);e&&document.body.removeChild(e)}const t=document.createElement("script");t.id=s,t.src=`https://fundf10.eastmoney.com/FundArchivesDatas.aspx?type=jjcc&code=${c}&topline=10&year=&month=&callback=${s}&_=${Date.now()}`,t.onerror=()=>{a(),n(new Error("获取重仓股失败"))},document.body.appendChild(t)})}function R(c){const o=[],n=/<tr[^>]*>[\s\S]*?<\/tr>/gi,s=c.match(n)||[];for(const r of s){if(r.includes("<th"))continue;const a=r.match(/quote_(\d{6})\.html/i),t=r.match(/<a[^>]*>([^<]+)<\/a>/i),e=/<td[^>]*>([^<]*)<\/td>/gi,i=[];let d;for(;(d=e.exec(r))!==null;)i.push((d[1]||"").trim());a&&a[1]&&t&&t[1]&&i.length>=4&&o.push({stockCode:a[1],stockName:t[1].trim(),holdingRatio:parseFloat((i[3]||"0").replace("%",""))||0,holdingAmount:i[2]||"0",changeFromLast:i[4]||"--"})}return o}async function L(){return new Promise(c=>{const o=`index_${Date.now()}_${Math.random().toString(36).slice(2)}`,n=setTimeout(()=>{s(),c([])},1e4);window[o]=a=>{if(s(),!a||!a.data||!a.data.diff){c([]);return}const t=a.data.diff.map(e=>({code:e.f12,name:e.f14,current:e.f2/100,change:e.f4/100,changeRate:e.f3/100,volume:e.f6/1e8}));c(t)};function s(){clearTimeout(n),delete window[o];const a=document.getElementById(o);a&&document.body.removeChild(a)}const r=document.createElement("script");r.id=o,r.src=`https://push2.eastmoney.com/api/qt/ulist.np/get?cb=${o}&fltt=2&secids=1.000001,0.399001,0.399006,1.000688&fields=f2,f3,f4,f6,f12,f14&_=${Date.now()}`,r.onerror=()=>{s(),c([])},document.body.appendChild(r)})}async function P(c="r",o="desc",n=20){return new Promise(s=>{const r=`rank_${Date.now()}_${Math.random().toString(36).slice(2)}`,a=setTimeout(()=>{t(),s([])},15e3);window[r]=i=>{if(t(),!i||!i.Data){s([]);return}const d=i.Data.map(l=>{const u=l.split(",");return{code:u[0]||"",name:u[1]||"",type:u[3]||"",netValue:parseFloat(u[4]??"0")||0,dayChange:parseFloat(u[6]??"0")||0,weekChange:parseFloat(u[7]??"0")||0,monthChange:parseFloat(u[8]??"0")||0,yearChange:parseFloat(u[11]??"0")||0}});s(d)};function t(){clearTimeout(a),delete window[r];const i=document.getElementById(r);i&&document.body.removeChild(i)}const e=document.createElement("script");e.id=r,e.src=`https://fund.eastmoney.com/data/rankhandler.aspx?op=ph&dt=kf&ft=all&rs=&gs=0&sc=${c}&st=${o}&pi=1&pn=${n}&dx=1&callback=${r}&_=${Date.now()}`,e.onerror=()=>{t(),s([])},document.body.appendChild(e)})}async function G(c,o=120){const n=await b(c,o+1);if(n.length<2)return[];const s=[],r=[...n].reverse();for(let a=1;a<r.length;a++){const t=r[a-1],e=r[a],i=t.netValue,d=e.netValue,l=Math.abs(d-i)*.3,u=Math.max(i,d)+l,p=Math.min(i,d)-l;s.push({time:e.date,open:parseFloat(i.toFixed(4)),high:parseFloat(u.toFixed(4)),low:parseFloat(Math.max(1e-4,p).toFixed(4)),close:parseFloat(d.toFixed(4))})}return s}const F=new Map;async function B(c){const o=F.get(c);return o&&Date.now()-o.timestamp<5e3?o.data:new Promise(n=>{const s=`timeshare_${Date.now()}_${Math.random().toString(36).slice(2)}`,r=setTimeout(()=>{a(),n([])},1e4);window[s]=e=>{if(a(),!e||!e.Data||!e.Data.netWorthTrend){n([]);return}const i=e.Data.netWorthTrend.map(d=>{const l=new Date(d.x),u=l.getHours().toString().padStart(2,"0"),p=l.getMinutes().toString().padStart(2,"0"),h=l.getSeconds().toString().padStart(2,"0");return{time:`${u}:${p}:${h}`,value:d.y,change:d.equityReturn||0}});F.set(c,{data:i,timestamp:Date.now()}),n(i)};function a(){clearTimeout(r),delete window[s];const e=document.getElementById(s);e&&document.body.removeChild(e)}const t=document.createElement("script");t.id=s,t.src=`https://fundgz.1234567.com.cn/js/${c}.js?rt=${Date.now()}`,t.onerror=()=>{a(),n([])},document.body.appendChild(t)})}function I(c,o){const n=o.toLowerCase();return n.includes("c类")||n.endsWith("c")||n.includes("(c)")?"C":(n.includes("a类")||n.endsWith("a")||n.includes("(a)"),"A")}async function J(c){return new Promise(o=>{const n=`fee_${Date.now()}_${Math.random().toString(36).slice(2)}`,s=setTimeout(()=>{r(),o(y(c))},1e4);window[n]=t=>{if(r(),!t||!t.Datas){o(y(c));return}try{const e=t.Datas,i={code:c,shareClass:I(c,e.SHORTNAME||""),buyFeeRate:parseFloat(e.MAXSG)||.15,sellFeeRates:_(e.SHFL),serviceFeeRate:parseFloat(e.XSJF)||.4,managementFeeRate:parseFloat(e.GLFL)||.5,custodianFeeRate:parseFloat(e.TGFL)||.1};o(i)}catch{o(y(c))}};function r(){clearTimeout(s),delete window[n];const t=document.getElementById(n);t&&document.body.removeChild(t)}const a=document.createElement("script");a.id=n,a.src=`https://fundgz.1234567.com.cn/FundNew/GetFundMJJZ?callback=${n}&fcode=${c}&_=${Date.now()}`,a.onerror=()=>{r(),o(y(c))},document.body.appendChild(a)})}function _(c){const o=[{minDays:0,maxDays:7,rate:1.5},{minDays:7,maxDays:30,rate:.75},{minDays:30,maxDays:365,rate:.5},{minDays:365,maxDays:730,rate:.25},{minDays:730,maxDays:1/0,rate:0}];return o}function y(c){return{code:c,shareClass:"A",buyFeeRate:.15,sellFeeRates:[{minDays:0,maxDays:7,rate:1.5},{minDays:7,maxDays:30,rate:.75},{minDays:30,maxDays:365,rate:.5},{minDays:365,maxDays:730,rate:.25},{minDays:730,maxDays:1/0,rate:0}],serviceFeeRate:.4,managementFeeRate:.5,custodianFeeRate:.1}}function O(c,o,n){const s=c*(o/100),r=n?c-s:c;return{fee:Math.round(s*100)/100,actualAmount:r,shares:0,netValue:0,calculateShares:a=>r/a}}function V(c,o,n,s){const r=c*o,a=s.find(e=>n>=e.minDays&&n<e.maxDays),t=a?a.rate:0;return Math.round(r*(t/100)*100)/100}function Y(c,o,n){const s=c*o,r=n/365/100,a=s*r;return a<.01&&a>0?.01:Math.round(a*100)/100}async function H(c){return new Promise(o=>{const n=`detail_${Date.now()}_${Math.random().toString(36).slice(2)}`,s=setTimeout(()=>{r(),o(null)},15e3);window[n]=t=>{if(r(),!t||!t.Datas){o(null);return}try{const e=t.Datas;o({code:e.FCODE||c,name:e.SHORTNAME||"",fullName:e.FULLNAME||"",type:e.FTYPE||"",establishDate:e.ESTABDATE||"",scale:parseFloat(e.ENDNAV)/1e8||0,scaleDate:e.FEGMRQ||"",company:e.JJGS||"",manager:e.JJJL||"",managerId:"",managerPhoto:"",custodian:e.TGYH||"",benchmark:e.BENCH||"",riskLevel:parseInt(e.RISKLEVEL)||3,rating:parseInt(e.RLEVEL_SZ)||0,buyStatus:e.SGZT||"--",sellStatus:e.SHZT||"--",minBuy:parseFloat(e.MINSG)||10,buyFeeRate:e.SOURCERATE||"--",manageFeeRate:e.MGREXP||"--",trustFeeRate:e.TRUSTEXP||"--",serviceFeeRate:e.SALESEXP||"--"})}catch{o(null)}};function r(){clearTimeout(s),delete window[n];const t=document.getElementById(n);t&&document.body.removeChild(t)}const a=document.createElement("script");a.id=n,a.src=`https://fundmobapi.eastmoney.com/FundMNewApi/FundMNDetailInformation?callback=${n}&FCODE=${c}&_=${Date.now()}`,a.onerror=()=>{r(),o(null)},document.body.appendChild(a)})}async function j(c){return new Promise(o=>{const n=`period_${Date.now()}`,s=setTimeout(()=>{a(),E(c).then(o)},8e3),r=document.createElement("script");r.id=n,r.src=`https://fund.eastmoney.com/pingzhongdata/${c}.js?_=${Date.now()}`,r.onload=()=>{a();try{const t=window.syl_1n||0,e=window.syl_6y||0,i=window.syl_3y||0,d=window.syl_1y||0,l=window.Data_netWorthTrend||[],u=[];if(l.length>0){const p=l[l.length-1]?.y||0,h=Date.now();[{key:"Z",label:"近1周",days:7},{key:"Y",label:"近1月",days:30},{key:"3Y",label:"近3月",days:90},{key:"6Y",label:"近6月",days:180},{key:"1N",label:"近1年",days:365}].forEach(w=>{const $=h-w.days*24*60*60*1e3,D=l.find(g=>g.x>=$);if(D&&p>0){const g=(p-D.y)/D.y*100;u.push({period:w.key,label:w.label,change:parseFloat(g.toFixed(2)),rank:0,total:0,avgChange:0,hs300Change:0})}})}o(u.length>0?u:[])}catch(t){console.error("解析阶段涨幅数据失败:",t),o([])}},r.onerror=()=>{a(),E(c).then(o)};function a(){clearTimeout(s);const t=document.getElementById(n);t&&document.body.removeChild(t)}document.body.appendChild(r)})}async function E(c){try{const o=await b(c,365);if(o.length<2)return[];const n=o[0],s=[],r=new Date;return[{key:"Z",label:"近1周",days:7},{key:"Y",label:"近1月",days:30},{key:"3Y",label:"近3月",days:90},{key:"6Y",label:"近6月",days:180},{key:"1N",label:"近1年",days:365}].forEach(t=>{const e=new Date(r.getTime()-t.days*24*60*60*1e3),i=o.find(d=>new Date(d.date)<=e);if(i){const d=(n.netValue-i.netValue)/i.netValue*100;s.push({period:t.key,label:t.label,change:parseFloat(d.toFixed(2)),rank:0,total:0,avgChange:0,hs300Change:0})}}),s}catch{return[]}}async function Z(c){return new Promise(o=>{const n=`mgr_${Date.now()}_${Math.random().toString(36).slice(2)}`,s=setTimeout(()=>{r(),o(null)},15e3);window[n]=t=>{if(r(),!t||!t.Datas){o(null);return}try{const e=t.Datas;o({id:e.MGRID||c,name:e.MGRNAME||"",photo:e.NEWPHOTOURL||"",company:e.JJGS||"",workingDays:parseInt(e.TOTALDAYS)||0,managedScale:parseFloat(e.NETNAV)/1e8||0,managedCount:parseInt(e.FCOUNT)||0,bestReturn:parseFloat(e.MAXPENAVGROWTH)||0,annualReturn:parseFloat(e.YIELDSE)||0,overallScore:parseFloat(e.MGOLD)||0,experienceScore:parseFloat(e.SDAY)||0,returnScore:parseFloat(e.SY1)||0,excessScore:parseFloat(e.SINFO1)||0})}catch{o(null)}};function r(){clearTimeout(s),delete window[n];const t=document.getElementById(n);t&&document.body.removeChild(t)}const a=document.createElement("script");a.id=n,a.src=`https://fundmobapi.eastmoney.com/FundMNewApi/FundMSNMangerInfo?callback=${n}&FCODE=${c}&_=${Date.now()}`,a.onerror=()=>{r(),o(null)},document.body.appendChild(a)})}async function z(c,o="1n"){return new Promise(n=>{const s=`rank_${Date.now()}_${Math.random().toString(36).slice(2)}`,r=setTimeout(()=>{a(),n([])},15e3);window[s]=e=>{if(a(),!e||!e.Datas){n([]);return}const i=e.Datas.map(d=>({date:d.PDATE,rank:parseInt(d.QRANK)||0,total:parseInt(d.QSC)||0}));n(i)};function a(){clearTimeout(r),delete window[s];const e=document.getElementById(s);e&&document.body.removeChild(e)}const t=document.createElement("script");t.id=s,t.src=`https://fundmobapi.eastmoney.com/FundMNewApi/FundRankDiagram?callback=${s}&FCODE=${c}&RANGE=${o}&_=${Date.now()}`,t.onerror=()=>{a(),n([])},document.body.appendChild(t)})}async function W(c,o="1n",n="000300"){return new Promise(s=>{const r=`acc_${Date.now()}_${Math.random().toString(36).slice(2)}`,a=setTimeout(()=>{t(),s([])},15e3);window[r]=i=>{if(t(),!i||!i.Datas){s([]);return}const d=i.Datas.map(l=>({date:l.PDATE,fundReturn:parseFloat(l.YIELD)||0,indexReturn:parseFloat(l.INDEXYIELD)||0,avgReturn:parseFloat(l.FUNDTYPEYIELD)||0}));s(d)};function t(){clearTimeout(a),delete window[r];const i=document.getElementById(r);i&&document.body.removeChild(i)}const e=document.createElement("script");e.id=r,e.src=`https://fundmobapi.eastmoney.com/FundMNewApi/FundVPageAcc?callback=${r}&FCODE=${c}&RANGE=${o}&INDEXCODE=${n}&_=${Date.now()}`,e.onerror=()=>{t(),s([])},document.body.appendChild(e)})}export{O as calculateBuyFee,Y as calculateDailyServiceFee,V as calculateSellFee,I as detectShareClass,W as fetchAccumulatedReturn,H as fetchFundDetailInfo,S as fetchFundEstimate,N as fetchFundEstimates,J as fetchFundFeeInfo,T as fetchFundList,Z as fetchFundManagerInfo,P as fetchFundRanking,G as fetchKLineData,L as fetchMarketIndices,b as fetchNetValueHistory,j as fetchPeriodChanges,z as fetchRankTrend,A as fetchStockHoldings,B as fetchTimeShareData,x as searchFund};
