import{aH as X,d as G,t as Y,r as i,aI as Z,w as A,aJ as ee,o as te,u as ae,j as ne,k as s,v as le,am as H,s as oe,a2 as se,ar as re,y as ie,c as ue,p as de,B as ce,R as j,S as fe,M as n,N as p,a0 as ve,aG as me,L as E,W as pe,Z as he,a3 as J,J as q,U as ge,V as be,O as _e,X as ye,_ as we}from"./index-COLuSNnH.js";/* empty css              *//* empty css              */import{P as ke}from"./index-cfsjtYB3.js";/* empty css              */import{P as xe}from"./index-lh23UwTI.js";import{N as Re}from"./index-DtBFF6eJ.js";const Ce=Symbol(),Te=()=>X(Ce,null),[ze,T,Fe]=ue("list"),Se={error:Boolean,offset:ie(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:re("down"),loadingText:{type:String,default:""},finishedText:String,immediateCheck:Y};var Pe=G({name:ze,props:Se,emits:["load","update:error","update:loading"],setup(a,{emit:w,slots:r}){const d=i(a.loading),c=i(),k=i(),v=Te(),x=Z(c),h=de(()=>a.scroller||x.value),u=()=>{le(()=>{if(d.value||a.finished||a.disabled||a.error||v?.value===!1)return;const{direction:l}=a,f=+a.offset,m=H(h);if(!m.height||oe(c))return;let g=!1;const L=H(k);l==="up"?g=m.top-L.top<=f:g=L.bottom-m.bottom<=f,g&&(d.value=!0,w("update:loading",!0),w("load"))})},R=()=>{if(a.finished){const l=r.finished?r.finished():a.finishedText;if(l)return s("div",{class:T("finished-text")},[l])}},z=()=>{w("update:error",!1),u()},M=()=>{if(a.error){const l=r.error?r.error():a.errorText;if(l)return s("div",{role:"button",class:T("error-text"),tabindex:0,onClick:z},[l])}},I=()=>{if(d.value&&!a.finished&&!a.disabled)return s("div",{class:T("loading")},[r.loading?r.loading():a.loadingText!=null&&s(se,{class:T("loading-icon")},{default:()=>[a.loadingText||Fe("loading")]})])};return A(()=>[a.loading,a.finished,a.error],u),v&&A(v,l=>{l&&u()}),ee(()=>{d.value=a.loading}),te(()=>{a.immediateCheck&&u()}),ae({check:u}),ne("scroll",u,{target:h,passive:!0}),()=>{var l;const f=(l=r.default)==null?void 0:l.call(r),m=s("div",{ref:k,class:T("placeholder")},null);return s("div",{ref:c,role:"feed",class:T(),"aria-busy":d.value},[a.direction==="down"?f:m,I(),R(),M(),a.direction==="up"?f:m])}}});const $e=ce(Pe),Be={class:"filter-page"},Le={class:"filter-bar"},Ve={class:"filter-item input-item"},Ne={class:"fund-list"},De={class:"list-header"},Ee={class:"col-return"},Me=["onClick"],Ie={class:"col-name"},Ue={class:"fund-name"},Oe={class:"fund-code"},je={class:"col-type"},K=30,qe=G({__name:"Filter",setup(a){const w=pe(),r=i(""),d=i(""),c=i("dayReturn"),k=[{value:"",label:"全部类型"},{value:"gp",label:"股票型"},{value:"hh",label:"混合型"},{value:"zq",label:"债券型"},{value:"zs",label:"指数型"},{value:"qdii",label:"QDII"},{value:"fof",label:"FOF"},{value:"hb",label:"货币型"}],v=[{value:"dayReturn",label:"日涨幅"},{value:"weekReturn",label:"周涨幅"},{value:"monthReturn",label:"月涨幅"},{value:"yearReturn",label:"年涨幅"}],x=i([]),h=i(!1),u=i(!1),R=i(!0),z=i(1);function M(o){return{gp:"001",hh:"002",zq:"003",zs:"005",qdii:"006",fof:"015",hb:"004"}[o]||""}function I(o){return{dayReturn:"rzdf",weekReturn:"zzf",monthReturn:"jzzzf",yearReturn:"lnzz"}[o]||"rzdf"}async function l(o=!1){if(!h.value&&!(!o&&!R.value)){o&&(z.value=1,x.value=[],R.value=!0),h.value=!0;try{const t=r.value?M(r.value):"",U=I(c.value),V=`https://fund.eastmoney.com/data/rankhandler.aspx?op=ph&dt=kf&ft=${t}&rs=&gs=0&sc=${U}&st=desc&pi=${z.value}&pn=${K}&dx=1&v=${Date.now()}`,P=await new Promise(b=>{const _=`filter_${Date.now()}_${Math.random().toString(36).slice(2)}`,e=document.createElement("script");e.id=_,delete window.rankData;let O=!1;const B=N=>{if(O)return;O=!0;const C=document.getElementById(_);C&&C.parentNode&&C.parentNode.removeChild(C),b(N)};e.onload=()=>{setTimeout(()=>{try{const N=window.rankData;if(N?.datas?.length){const C=N.datas.map(D=>{const y=D.split(",");return{code:y[0]||"",name:y[1]||"",type:k.find(W=>W.value===r.value)?.label||"混合型",dayReturn:parseFloat(y[6]??"0")||0,weekReturn:parseFloat(y[7]??"0")||0,monthReturn:parseFloat(y[8]??"0")||0,yearReturn:parseFloat(y[11]??"0")||0,netValue:parseFloat(y[4]??"0")||0}}).filter(D=>D.code&&D.name);B(C)}else B([])}catch{B([])}},150)},e.onerror=()=>B([]),setTimeout(()=>B([]),3e3),e.src=V,document.body.appendChild(e)});P.length<K&&(R.value=!1);let $=P;if(d.value){const b=parseFloat(d.value);if(!isNaN(b)){const _=c.value;$=P.filter(e=>e[_]>=b)}}x.value=o?$:[...x.value,...$],z.value++}catch(t){console.error("加载基金列表失败:",t),J("加载失败")}finally{h.value=!1}}}function f(){l(!0)}async function m(){u.value=!0;try{await l(!0),J("刷新成功")}finally{u.value=!1}}function g(o){return o[c.value]}function L(o){w.push(`/detail/${o}`)}function Q(o){return o>0?"up":o<0?"down":"flat"}const F=i(!1),S=i(!1);return(o,t)=>{const U=Re,V=ye,P=$e,$=xe,b=ke,_=he;return q(),j("div",Be,[s(U,{title:"基金筛选","left-arrow":"",onClickLeft:t[0]||(t[0]=e=>fe(w).back())}),n("div",Le,[n("div",{class:"filter-item",onClick:t[1]||(t[1]=e=>S.value=!0)},[n("span",null,p(k.find(e=>e.value===r.value)?.label||"全部类型"),1),s(V,{name:"arrow-down",size:"12"})]),n("div",{class:"filter-item",onClick:t[2]||(t[2]=e=>F.value=!0)},[n("span",null,p(v.find(e=>e.value===c.value)?.label),1),s(V,{name:"arrow-down",size:"12"})]),n("div",Ve,[ve(n("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>d.value=e),type:"number",placeholder:"最低%",class:"min-return-input",onChange:f},null,544),[[me,d.value]])])]),n("div",Ne,[s($,{modelValue:u.value,"onUpdate:modelValue":t[4]||(t[4]=e=>u.value=e),onRefresh:m},{default:E(()=>[s(P,{loading:h.value,finished:!R.value,"finished-text":"没有更多了","immediate-check":!0,onLoad:l},{default:E(()=>[n("div",De,[t[11]||(t[11]=n("span",{class:"col-name"},"基金名称",-1)),t[12]||(t[12]=n("span",{class:"col-type"},"类型",-1)),n("span",Ee,p(v.find(e=>e.value===c.value)?.label),1)]),(q(!0),j(ge,null,be(x.value,e=>(q(),j("div",{key:e.code,class:"fund-item",onClick:O=>L(e.code)},[n("div",Ie,[n("span",Ue,p(e.name),1),n("span",Oe,p(e.code),1)]),n("span",je,p(e.type),1),n("span",{class:_e(["col-return",Q(g(e))])},p(g(e)>=0?"+":"")+p(g(e).toFixed(2))+"% ",3)],8,Me))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])]),s(_,{show:S.value,"onUpdate:show":t[7]||(t[7]=e=>S.value=e),position:"bottom",round:""},{default:E(()=>[s(b,{columns:k.map(e=>({text:e.label,value:e.value})),onConfirm:t[5]||(t[5]=e=>{r.value=e.selectedValues[0]||"",S.value=!1,f()}),onCancel:t[6]||(t[6]=e=>S.value=!1)},null,8,["columns"])]),_:1},8,["show"]),s(_,{show:F.value,"onUpdate:show":t[10]||(t[10]=e=>F.value=e),position:"bottom",round:""},{default:E(()=>[s(b,{columns:v.map(e=>({text:e.label,value:e.value})),onConfirm:t[8]||(t[8]=e=>{c.value=e.selectedValues[0]||"dayReturn",F.value=!1,f()}),onCancel:t[9]||(t[9]=e=>F.value=!1)},null,8,["columns"])]),_:1},8,["show"])])}}}),Xe=we(qe,[["__scopeId","data-v-733f7907"]]);export{Xe as default};
