import{d as es,o as ts,R as n,k as r,L as x,r as c,a4 as as,a5 as os,a6 as ns,a7 as ls,Z as is,J as a,X as cs,M as s,N as o,T as f,U as m,V as h,a8 as H,O as v,K as y,S as d,P as J,$ as us,p as ds,a3 as K,W as rs,a2 as vs,_ as _s}from"./index-COLuSNnH.js";/* empty css              *//* empty css              *//* empty css              */import{P as ps}from"./index-lh23UwTI.js";import{N as fs}from"./index-DtBFF6eJ.js";import{fetchMarketIndicesFast as ms}from"./fundFast-BTB3GdVE.js";import{g,f as k}from"./format-DMY7EWAz.js";import{B as hs}from"./index-dROw2vyl.js";const ys={class:"market-page"},gs={class:"section"},ks={class:"section-header"},ws={key:0,class:"update-time"},bs={key:0,class:"distribution-chart"},xs={class:"chart-bars"},Cs=["onClick"],Rs={class:"bar-value"},Fs={class:"bar-label"},Ts={class:"updown-bar"},$s={class:"down-section"},Ss={class:"count"},Ds={class:"up-section"},Ls={class:"count"},Ps={class:"section"},Vs={key:0,class:"indices-grid"},Bs={class:"index-name"},Ms={class:"index-current"},Ns={class:"index-change"},Us={class:"section"},Is={key:0,class:"fund-list"},Os=["onClick"],Es={class:"fund-info"},zs={class:"fund-name"},qs={class:"fund-meta"},Hs={class:"update-tag"},Js={class:"fund-code"},Ks={class:"fund-value"},Ws={class:"section"},Xs={key:0,class:"sector-list"},Zs=["onClick"],js={class:"sector-info"},As={class:"sector-name"},Gs={key:0,class:"sector-meta"},Qs={class:"section"},Ys={key:0,class:"etf-list"},se=["onClick"],ee={class:"etf-info"},te={class:"etf-name"},ae={class:"etf-code"},oe={class:"etf-price"},ne={key:0,class:"sector-popup"},le={class:"sector-popup-header"},ie={class:"sector-popup-title"},ce={class:"sector-popup-content"},ue={class:"sector-popup-info"},de={class:"info-row"},re={key:0,class:"info-row"},ve={class:"value streak"},_e={key:1,class:"info-row"},pe={class:"value"},fe={class:"sector-popup-actions"},me=es({__name:"Market",setup(he){const L=rs(),w=c(!1),P=c([]),C=c(!0),l=c(null),b=c(!0),R=c(null),V=c([]),F=c(!0),B=c([]),T=c(!0),M=c([]),$=c(!0),_=c(!1),u=c(null),W=ds(()=>l.value?Math.max(...l.value.distribution.map(i=>i.count),1):1);async function N(){C.value=!0;try{P.value=await ms()}catch{}finally{C.value=!1}}async function U(){R.value?(l.value=R.value,b.value=!1):b.value=!0;try{const i=await as();i&&(l.value=i,R.value=i)}catch{l.value||(l.value={updateTime:"--",totalUp:0,totalDown:0,distribution:[{range:"≤-5",count:0,min:-1/0,max:-5},{range:"-5~-3",count:0,min:-5,max:-3},{range:"-3~-1",count:0,min:-3,max:-1},{range:"-1~0",count:0,min:-1,max:0},{range:"0~1",count:0,min:0,max:1},{range:"1~3",count:0,min:1,max:3},{range:"3~5",count:0,min:3,max:5},{range:"≥5",count:0,min:5,max:1/0}]})}finally{b.value=!1}}async function I(){F.value=!0;try{V.value=await os("desc",10)}catch{}finally{F.value=!1}}async function O(){T.value=!0;try{B.value=await ns()}catch{}finally{T.value=!1}}async function E(){$.value=!0;try{M.value=await ls(10)}catch{}finally{$.value=!1}}async function z(){w.value=!0;try{await Promise.all([N(),U(),I(),O(),E()]),K("刷新成功")}finally{w.value=!1}}function q(i){L.push(`/detail/${i}`)}function X(i){u.value=i,_.value=!0}function Z(){u.value&&(_.value=!1,L.push({path:"/search",query:{q:u.value.name}}))}function j(i){i.count>0&&K(`${i.range}: ${i.count} 只基金`)}function A(i){return i.includes("-")?"down":i==="0~1"?"neutral":"up"}return ts(()=>{N(),U(),I(),O(),E()}),(i,t)=>{const S=cs,G=fs,p=vs,Q=ps,Y=hs,ss=is;return a(),n("div",ys,[r(G,{title:"行情"},{right:x(()=>[r(S,{name:"replay",size:"18",onClick:z})]),_:1}),r(Q,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e),onRefresh:z,class:"market-content"},{default:x(()=>[s("div",gs,[s("div",ks,[t[3]||(t[3]=s("span",{class:"section-title"},"基金涨跌分布",-1)),l.value?(a(),n("span",ws,"更新: "+o(l.value.updateTime),1)):f("",!0)]),!b.value&&l.value?(a(),n("div",bs,[s("div",xs,[(a(!0),n(m,null,h(l.value.distribution,e=>(a(),n("div",{key:e.range,class:"bar-item",onClick:D=>j(e)},[s("div",Rs,o(e.count||""),1),s("div",{class:v(["bar",A(e.range)]),style:H({height:`${e.count/W.value*100}px`})},null,6),s("div",Fs,o(e.range),1)],8,Cs))),128))]),s("div",Ts,[s("div",$s,[t[4]||(t[4]=s("span",{class:"label"},"下跌",-1)),s("span",Ss,o(l.value.totalDown),1)]),s("div",{class:"progress-bar",style:H({background:`linear-gradient(to right, var(--color-down) ${l.value.totalDown/(l.value.totalDown+l.value.totalUp)*100}%, var(--color-up) ${l.value.totalDown/(l.value.totalDown+l.value.totalUp)*100}%)`})},null,4),s("div",Ds,[s("span",Ls,o(l.value.totalUp),1),t[5]||(t[5]=s("span",{class:"label"},"上涨",-1))])])])):(a(),y(p,{key:1,class:"loading-box"}))]),s("div",Ps,[t[6]||(t[6]=s("div",{class:"section-header"},[s("span",{class:"section-title"},"大盘指数")],-1)),C.value?(a(),y(p,{key:1,class:"loading-box"})):(a(),n("div",Vs,[(a(!0),n(m,null,h(P.value,e=>(a(),n("div",{key:e.code,class:v(["index-card",d(g)(e.changePercent)])},[s("div",Bs,o(e.name),1),s("div",Ms,o(e.current.toFixed(2)),1),s("div",Ns,[s("span",null,o(e.change>=0?"+":"")+o(e.change.toFixed(2)),1),s("span",null,o(d(k)(e.changePercent)),1)])],2))),128))]))]),s("div",Us,[t[7]||(t[7]=s("div",{class:"section-header"},[s("span",{class:"section-title"},"场外基金")],-1)),F.value?(a(),y(p,{key:1,class:"loading-box"})):(a(),n("div",Is,[(a(!0),n(m,null,h(V.value,e=>(a(),n("div",{key:e.code,class:"fund-item",onClick:J(D=>q(e.code),["stop"])},[s("div",Es,[s("div",zs,o(e.name),1),s("div",qs,[s("span",Hs,o(e.updateStatus),1),s("span",Js,o(e.code),1)])]),s("div",Ks,o(e.netValue.toFixed(4)),1),s("div",{class:v(["fund-change",d(g)(e.dayReturn)])},o(d(k)(e.dayReturn)),3)],8,Os))),128))]))]),s("div",Ws,[t[8]||(t[8]=s("div",{class:"section-header"},[s("span",{class:"section-title"},"板块总览")],-1)),T.value?(a(),y(p,{key:1,class:"loading-box"})):(a(),n("div",Xs,[(a(!0),n(m,null,h(B.value,e=>(a(),n("div",{key:e.code||e.name,class:"sector-item",onClick:D=>X(e)},[s("div",js,[s("div",As,o(e.name),1),e.streak?(a(),n("div",Gs,o(e.streak),1)):f("",!0)]),s("div",{class:v(["sector-change",d(g)(e.dayReturn)])},o(d(k)(e.dayReturn)),3),r(S,{name:"arrow",class:"sector-arrow"})],8,Zs))),128))]))]),s("div",Qs,[t[9]||(t[9]=s("div",{class:"section-header"},[s("span",{class:"section-title"},"场内ETF")],-1)),$.value?(a(),y(p,{key:1,class:"loading-box"})):(a(),n("div",Ys,[(a(!0),n(m,null,h(M.value,e=>(a(),n("div",{key:e.code,class:"etf-item",onClick:J(D=>q(e.code),["stop"])},[s("div",ee,[s("div",te,o(e.name),1),s("div",ae,o(e.code),1)]),s("div",oe,o(e.price.toFixed(4)),1),s("div",{class:v(["etf-change",d(g)(e.dayReturn)])},o(d(k)(e.dayReturn)),3)],8,se))),128))]))]),t[10]||(t[10]=s("div",{class:"bottom-spacer"},null,-1))]),_:1},8,["modelValue"]),r(ss,{show:_.value,"onUpdate:show":t[2]||(t[2]=e=>_.value=e),position:"bottom",round:"",style:{maxHeight:"60%"}},{default:x(()=>[u.value?(a(),n("div",ne,[s("div",le,[s("div",ie,o(u.value.name),1),r(S,{name:"cross",onClick:t[1]||(t[1]=e=>_.value=!1)})]),s("div",ce,[s("div",ue,[s("div",de,[t[11]||(t[11]=s("span",{class:"label"},"今日涨幅",-1)),s("span",{class:v(["value",d(g)(u.value.dayReturn)])},o(d(k)(u.value.dayReturn)),3)]),u.value.streak?(a(),n("div",re,[t[12]||(t[12]=s("span",{class:"label"},"连续表现",-1)),s("span",ve,o(u.value.streak),1)])):f("",!0),u.value.funds&&u.value.funds.length>0?(a(),n("div",_e,[t[13]||(t[13]=s("span",{class:"label"},"领涨基金",-1)),s("span",pe,o(u.value.funds[0].name),1)])):f("",!0)]),s("div",fe,[r(Y,{type:"primary",block:"",round:"",onClick:Z},{default:x(()=>[...t[14]||(t[14]=[us(" 搜索相关基金 ",-1)])]),_:1})])])])):f("",!0)]),_:1},8,["show"])])}}}),Te=_s(me,[["__scopeId","data-v-3a93366e"]]);export{Te as default};
