import{d as le,r as h,R as o,k as r,L as C,S as ie,M as s,N as c,U as w,V as b,W as de,p as M,Z as ue,J as l,X as re,O as A,T as J,$ as L,a8 as K,a0 as T,aG as z,a3 as x,_ as ce}from"./index-COLuSNnH.js";/* empty css              *//* empty css              *//* empty css              */import{N as ve}from"./index-DtBFF6eJ.js";import{u as pe}from"./fund-qjlmdvOA.js";import{B as fe}from"./index-dROw2vyl.js";import{s as me}from"./function-call-fsbkCKQc.js";import"./fundFast-BTB3GdVE.js";import"./storage-BvZjhTaj.js";const _e={class:"calendar-page"},he={class:"month-bar"},ye={class:"month-name"},ge={class:"calendar-grid"},ke={class:"weekday-row"},Ce={class:"days-grid"},we=["onClick"],be={class:"day-number"},Se={key:0,class:"event-dot"},$e={class:"events-section"},De={class:"events-header"},Ne={class:"events-date"},Me={class:"events-count"},xe={key:0,class:"events-empty"},Ee={key:1,class:"events-list"},Te={class:"event-content"},ze={class:"event-title"},Ve={class:"event-fund"},Fe={key:0,class:"event-desc"},Ie={class:"add-dialog"},Be={class:"dialog-header"},Ue={class:"dialog-content"},Ye={class:"field-item"},Oe={class:"field-value"},Pe={key:0},Ae={key:1,class:"placeholder"},Je={class:"field-item"},Le={class:"type-options"},Ke=["onClick"],Re={class:"field-item"},Ge={class:"field-item"},We={class:"fund-picker"},Xe={key:0,class:"empty-tip"},Ze={key:1,class:"fund-list"},je=["onClick"],qe={class:"fund-name"},He={class:"fund-code"},Qe=le({__name:"Calendar",setup(et){const R=de(),G=pe(),S=new Date,v=h(S.getFullYear()),i=h(S.getMonth()),_=h(I(S)),V={dividend:{label:"分红",color:"#f6465d",icon:"gold-coin-o"},subscribe:{label:"申购开放",color:"#0ecb81",icon:"plus"},redeem:{label:"赎回开放",color:"#1e90ff",icon:"minus"},other:{label:"其他",color:"#f7931a",icon:"info-o"}},m=h(W()),g=h(!1),a=h({date:_.value,fundCode:"",fundName:"",type:"dividend",title:"",description:""}),$=h(!1);function W(){try{const n=localStorage.getItem("calendar_events");return n?JSON.parse(n):[]}catch{return[]}}function F(){localStorage.setItem("calendar_events",JSON.stringify(m.value))}function I(n){return`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")}`}function B(n,e){return new Date(n,e+1,0).getDate()}function X(n,e){return new Date(n,e,1).getDay()}const Z=M(()=>{const n=B(v.value,i.value),e=X(v.value,i.value),d=[],D=i.value===0?11:i.value-1,k=i.value===0?v.value-1:v.value,N=B(k,D);for(let u=e-1;u>=0;u--){const f=N-u,y=`${k}-${(D+1).toString().padStart(2,"0")}-${f.toString().padStart(2,"0")}`;d.push({date:y,day:f,isCurrentMonth:!1,isToday:!1,hasEvent:m.value.some(oe=>oe.date===y)})}const t=I(S);for(let u=1;u<=n;u++){const f=`${v.value}-${(i.value+1).toString().padStart(2,"0")}-${u.toString().padStart(2,"0")}`;d.push({date:f,day:u,isCurrentMonth:!0,isToday:f===t,hasEvent:m.value.some(y=>y.date===f)})}const p=42-d.length,P=i.value===11?0:i.value+1,ae=i.value===11?v.value+1:v.value;for(let u=1;u<=p;u++){const f=`${ae}-${(P+1).toString().padStart(2,"0")}-${u.toString().padStart(2,"0")}`;d.push({date:f,day:u,isCurrentMonth:!1,isToday:!1,hasEvent:m.value.some(y=>y.date===f)})}return d}),j=M(()=>`${v.value}年${i.value+1}月`),E=M(()=>m.value.filter(n=>n.date===_.value));function q(){i.value===0?(i.value=11,v.value--):i.value--}function H(){i.value===11?(i.value=0,v.value++):i.value++}function Q(n){_.value=n}function ee(n){a.value.fundCode=n.code,a.value.fundName=n.name,$.value=!1}function te(){if(!a.value.fundCode){x("请选择基金");return}if(!a.value.title.trim()){x("请输入事件标题");return}const n={id:`event_${Date.now()}`,date:a.value.date,fundCode:a.value.fundCode,fundName:a.value.fundName,type:a.value.type,title:a.value.title.trim(),description:a.value.description.trim()};m.value.push(n),F(),x("添加成功"),g.value=!1,a.value={date:_.value,fundCode:"",fundName:"",type:"dividend",title:"",description:""}}async function se(n){try{await me({title:"删除事件",message:`确定删除「${n.title}」？`});const e=m.value.findIndex(d=>d.id===n.id);e!==-1&&(m.value.splice(e,1),F(),x("已删除"))}catch{}}function U(n){return V[n]}const Y=M(()=>G.watchlist.map(n=>({code:n.code,name:n.name||n.code})));function O(){a.value.date=_.value,g.value=!0}const ne=["日","一","二","三","四","五","六"];return(n,e)=>{const d=re,D=ve,k=fe,N=ue;return l(),o("div",_e,[r(D,{title:"投资日历","left-arrow":"",onClickLeft:e[0]||(e[0]=t=>ie(R).back())},{right:C(()=>[r(d,{name:"plus",size:"20",onClick:O})]),_:1}),s("div",he,[r(d,{name:"arrow-left",size:"20",onClick:q}),s("span",ye,c(j.value),1),r(d,{name:"arrow",size:"20",onClick:H})]),s("div",ge,[s("div",ke,[(l(),o(w,null,b(ne,t=>s("span",{key:t,class:"weekday-cell"},c(t),1)),64))]),s("div",Ce,[(l(!0),o(w,null,b(Z.value,t=>(l(),o("div",{key:t.date,class:A(["day-cell",{"other-month":!t.isCurrentMonth,today:t.isToday,selected:t.date===_.value,"has-event":t.hasEvent}]),onClick:p=>Q(t.date)},[s("span",be,c(t.day),1),t.hasEvent?(l(),o("span",Se)):J("",!0)],10,we))),128))])]),s("div",$e,[s("div",De,[s("span",Ne,c(_.value),1),s("span",Me,c(E.value.length)+"个事件",1)]),E.value.length===0?(l(),o("div",xe,[e[9]||(e[9]=s("span",null,"暂无事件",-1)),r(k,{size:"small",type:"primary",onClick:O},{default:C(()=>[...e[8]||(e[8]=[L("添加事件",-1)])]),_:1})])):(l(),o("div",Ee,[(l(!0),o(w,null,b(E.value,t=>(l(),o("div",{key:t.id,class:"event-item"},[s("div",{class:"event-type-badge",style:K({background:U(t.type).color})},[r(d,{name:U(t.type).icon,size:"14"},null,8,["name"])],4),s("div",Te,[s("div",ze,c(t.title),1),s("div",Ve,c(t.fundName),1),t.description?(l(),o("div",Fe,c(t.description),1)):J("",!0)]),r(d,{name:"delete-o",size:"18",class:"delete-btn",onClick:p=>se(t)},null,8,["onClick"])]))),128))]))]),r(N,{show:g.value,"onUpdate:show":e[6]||(e[6]=t=>g.value=t),position:"bottom",round:"",style:{height:"70%"}},{default:C(()=>[s("div",Ie,[s("div",Be,[e[10]||(e[10]=s("span",{class:"dialog-title"},"添加事件",-1)),r(d,{name:"cross",size:"20",onClick:e[1]||(e[1]=t=>g.value=!1)})]),s("div",Ue,[s("div",Ye,[e[11]||(e[11]=s("span",{class:"field-label"},"日期",-1)),T(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.date=t),type:"date",class:"date-input"},null,512),[[z,a.value.date]])]),s("div",{class:"field-item",onClick:e[3]||(e[3]=t=>$.value=!0)},[e[12]||(e[12]=s("span",{class:"field-label"},"基金",-1)),s("div",Oe,[a.value.fundCode?(l(),o("span",Pe,c(a.value.fundName||a.value.fundCode),1)):(l(),o("span",Ae,"从自选中选择")),r(d,{name:"arrow",size:"14"})])]),s("div",Je,[e[13]||(e[13]=s("span",{class:"field-label"},"类型",-1)),s("div",Le,[(l(),o(w,null,b(V,(t,p)=>s("span",{key:p,class:A(["type-btn",{active:a.value.type===p}]),style:K(a.value.type===p?{background:t.color}:{}),onClick:P=>a.value.type=p},c(t.label),15,Ke)),64))])]),s("div",Re,[e[14]||(e[14]=s("span",{class:"field-label"},"标题",-1)),T(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.title=t),type:"text",placeholder:"如：现金分红",class:"text-input"},null,512),[[z,a.value.title]])]),s("div",Ge,[e[15]||(e[15]=s("span",{class:"field-label"},"备注",-1)),T(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.description=t),placeholder:"可选",class:"textarea-input",rows:"2"},null,512),[[z,a.value.description]])]),r(k,{type:"primary",block:"",onClick:te},{default:C(()=>[...e[16]||(e[16]=[L(" 添加事件 ",-1)])]),_:1})])])]),_:1},8,["show"]),r(N,{show:$.value,"onUpdate:show":e[7]||(e[7]=t=>$.value=t),position:"bottom",round:"",style:{height:"50%"}},{default:C(()=>[s("div",We,[e[17]||(e[17]=s("div",{class:"picker-title"},"从自选中选择",-1)),Y.value.length===0?(l(),o("div",Xe," 暂无自选基金 ")):(l(),o("div",Ze,[(l(!0),o(w,null,b(Y.value,t=>(l(),o("div",{key:t.code,class:"fund-item",onClick:p=>ee(t)},[s("span",qe,c(t.name),1),s("span",He,c(t.code),1)],8,je))),128))]))])]),_:1},8,["show"])])}}}),ct=ce(Qe,[["__scopeId","data-v-6aa15d4f"]]);export{ct as default};
