import{c as A,A as G,H as E,an as fe,d as Q,n as L,C as oe,u as le,aK as ve,j as ce,k as f,ag as _,a9 as $,r as w,x as ie,z as he,p,aq as W,t as se,y as B,w as j,a2 as ge,m as be,F as X,G as Oe,ar as Te,aL as pe,v as Z,aM as ye,ac as q,B as ke}from"./index-COLuSNnH.js";const[Ce,T,ee]=A("picker"),ue=e=>e.find(o=>!o.disabled)||e[0];function xe(e,o){const a=e[0];if(a){if(Array.isArray(a))return"multiple";if(o.children in a)return"cascade"}return"default"}function V(e,o){o=G(o,0,e.length);for(let a=o;a<e.length;a++)if(!e[a].disabled)return a;for(let a=o-1;a>=0;a--)if(!e[a].disabled)return a;return 0}const te=(e,o,a)=>o!==void 0&&e.some(u=>u[a.value]===o);function J(e,o,a){const u=e.findIndex(v=>v[a.value]===o),c=V(e,u);return e[c]}function we(e,o,a){const u=[];let c={[o.children]:e},v=0;for(;c&&c[o.children];){const h=c[o.children],g=a.value[v];if(c=fe(g)?J(h,g,o):void 0,!c&&h.length){const r=ue(h)[o.value];c=J(h,r,o)}v++,u.push(h)}return u}function Ee(e){const{transform:o}=window.getComputedStyle(e),a=o.slice(7,o.length-1).split(", ")[5];return Number(a)}function Pe(e){return E({text:"text",value:"value",children:"children"},e)}const ne=200,ae=300,Se=15,[re,z]=A("picker-column"),me=Symbol(re);var Ie=Q({name:re,props:{value:L,fields:_(Object),options:$(),readonly:Boolean,allowHtml:Boolean,optionHeight:_(Number),swipeDuration:_(L),visibleOptionNum:_(L)},emits:["change","clickOption","scrollInto"],setup(e,{emit:o,slots:a}){let u,c,v,h,g;const r=w(),b=w(),m=w(0),d=w(0),y=he(),C=()=>e.options.length,H=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,k=l=>{let s=V(e.options,l);const t=-s*e.optionHeight,n=()=>{s>C()-1&&(s=V(e.options,l));const i=e.options[s][e.fields.value];i!==e.value&&o("change",i)};u&&t!==m.value?g=n:n(),m.value=t},O=()=>e.readonly||!e.options.length,F=l=>{u||O()||(g=null,d.value=ne,k(l),o("clickOption",e.options[l]))},x=l=>G(Math.round(-l/e.optionHeight),0,C()-1),M=p(()=>x(m.value)),K=(l,s)=>{const t=Math.abs(l/s);l=m.value+t/.003*(l<0?-1:1);const n=x(l);d.value=+e.swipeDuration,k(n)},P=()=>{u=!1,d.value=0,g&&(g(),g=null)},U=l=>{if(!O()){if(y.start(l),u){const s=Ee(b.value);m.value=Math.min(0,s-H())}d.value=0,c=m.value,v=Date.now(),h=c,g=null}},Y=l=>{if(O())return;y.move(l),y.isVertical()&&(u=!0,ie(l,!0));const s=G(c+y.deltaY.value,-(C()*e.optionHeight),e.optionHeight),t=x(s);t!==M.value&&o("scrollInto",e.options[t]),m.value=s;const n=Date.now();n-v>ae&&(v=n,h=s)},S=()=>{if(O())return;const l=m.value-h,s=Date.now()-v;if(s<ae&&Math.abs(l)>Se){K(l,s);return}const n=x(m.value);d.value=ne,k(n),setTimeout(()=>{u=!1},0)},D=()=>{const l={height:`${e.optionHeight}px`};return e.options.map((s,t)=>{const n=s[e.fields.text],{disabled:i}=s,N=s[e.fields.value],I={role:"button",style:l,tabindex:i?-1:0,class:[z("item",{disabled:i,selected:N===e.value}),s.className],onClick:()=>F(t)},de={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:n};return f("li",I,[a.option?a.option(s,t):f("div",de,null)])})};return oe(me),le({stopMomentum:P}),ve(()=>{const l=u?Math.floor(-m.value/e.optionHeight):e.options.findIndex(n=>n[e.fields.value]===e.value),s=V(e.options,l),t=-s*e.optionHeight;u&&s<l&&P(),m.value=t}),ce("touchmove",Y,{target:r}),()=>f("div",{ref:r,class:z(),onTouchstartPassive:U,onTouchend:S,onTouchcancel:S},[f("ul",{ref:b,style:{transform:`translate3d(0, ${m.value+H()}px, 0)`,transitionDuration:`${d.value}ms`,transitionProperty:d.value?"all":"none"},class:z("wrapper"),onTransitionend:P},[D()])])}});const[He]=A("picker-toolbar"),R={title:String,cancelButtonText:String,confirmButtonText:String},Me=["cancel","confirm","title","toolbar"],De=Object.keys(R);var Ne=Q({name:He,props:R,emits:["confirm","cancel"],setup(e,{emit:o,slots:a}){const u=()=>{if(a.title)return a.title();if(e.title)return f("div",{class:[T("title"),"van-ellipsis"]},[e.title])},c=()=>o("cancel"),v=()=>o("confirm"),h=()=>{var r;const b=(r=e.cancelButtonText)!=null?r:ee("cancel");if(!(!a.cancel&&!b))return f("button",{type:"button",class:[T("cancel"),W],onClick:c},[a.cancel?a.cancel():b])},g=()=>{var r;const b=(r=e.confirmButtonText)!=null?r:ee("confirm");if(!(!a.confirm&&!b))return f("button",{type:"button",class:[T("confirm"),W],onClick:v},[a.confirm?a.confirm():b])};return()=>f("div",{class:T("toolbar")},[a.toolbar?a.toolbar():[h(),u(),g()]])}});const[_e]=A("picker-group"),Be=Symbol(_e);E({tabs:$(),activeTab:B(0),nextStepText:String,showToolbar:se},R);const Ve=E({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:B(44),showToolbar:se,swipeDuration:B(1e3),visibleOptionNum:B(6)},R),$e=E({},Ve,{columns:$(),modelValue:$(),toolbarPosition:Te("top"),columnsFieldNames:Object});var Ae=Q({name:Ce,props:$e,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:o,slots:a}){const u=w(),c=w(e.modelValue.slice(0)),{parent:v}=oe(Be),{children:h,linkChildren:g}=be(me);g();const r=p(()=>Pe(e.columnsFieldNames)),b=p(()=>ye(e.optionHeight)),m=p(()=>xe(e.columns,r.value)),d=p(()=>{const{columns:t}=e;switch(m.value){case"multiple":return t;case"cascade":return we(t,r.value,c);default:return[t]}}),y=p(()=>d.value.some(t=>t.length)),C=p(()=>d.value.map((t,n)=>J(t,c.value[n],r.value))),H=p(()=>d.value.map((t,n)=>t.findIndex(i=>i[r.value.value]===c.value[n]))),k=(t,n)=>{if(c.value[t]!==n){const i=c.value.slice(0);i[t]=n,c.value=i}},O=()=>({selectedValues:c.value.slice(0),selectedOptions:C.value,selectedIndexes:H.value}),F=(t,n)=>{k(n,t),m.value==="cascade"&&c.value.forEach((i,N)=>{const I=d.value[N];te(I,i,r.value)||k(N,I.length?I[0][r.value.value]:void 0)}),Z(()=>{o("change",E({columnIndex:n},O()))})},x=(t,n)=>{const i={columnIndex:n,currentOption:t};o("clickOption",E(O(),i)),o("scrollInto",i)},M=()=>{h.forEach(n=>n.stopMomentum());const t=O();return Z(()=>{const n=O();o("confirm",n)}),t},K=()=>o("cancel",O()),P=()=>d.value.map((t,n)=>f(Ie,{value:c.value[n],fields:r.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:b.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:i=>F(i,n),onClickOption:i=>x(i,n),onScrollInto:i=>{o("scrollInto",{currentOption:i,columnIndex:n})}},{option:a.option})),U=t=>{if(y.value){const n={height:`${b.value}px`},i={backgroundSize:`100% ${(t-b.value)/2}px`};return[f("div",{class:T("mask"),style:i},null),f("div",{class:[pe,T("frame")],style:n},null)]}},Y=()=>{const t=b.value*+e.visibleOptionNum,n={height:`${t}px`};return!e.loading&&!y.value&&a.empty?a.empty():f("div",{ref:u,class:T("columns"),style:n},[P(),U(t)])},S=()=>{if(e.showToolbar&&!v)return f(Ne,Oe(X(e,De),{onConfirm:M,onCancel:K}),X(a,Me))},D=t=>{t.forEach((n,i)=>{n.length&&!te(n,c.value[i],r.value)&&k(i,ue(n)[r.value.value])})};j(d,t=>D(t),{immediate:!0});let l;return j(()=>e.modelValue,t=>{!q(t,c.value)&&!q(t,l)&&(c.value=t.slice(0),l=t.slice(0)),e.modelValue.length===0&&D(d.value)},{deep:!0}),j(c,t=>{q(t,e.modelValue)||(l=t.slice(0),o("update:modelValue",l))},{immediate:!0}),ce("touchmove",ie,{target:u}),le({confirm:M,getSelectedOptions:()=>C.value}),()=>{var t,n;return f("div",{class:T()},[e.toolbarPosition==="top"?S():null,e.loading?f(ge,{class:T("loading")},null):null,(t=a["columns-top"])==null?void 0:t.call(a),Y(),(n=a["columns-bottom"])==null?void 0:n.call(a),e.toolbarPosition==="bottom"?S():null])}}});const Fe=ke(Ae);export{Fe as P,Ve as p};
