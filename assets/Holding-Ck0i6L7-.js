const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fundFast-BTB3GdVE.js","assets/index-COLuSNnH.js","assets/index-DUg9U2wc.css"])))=>i.map(i=>d[i]);
import{c as oe,d as ne,C as Se,w as le,u as fe,E as Me,k as v,F as ye,G as pe,p as S,H as se,t as Re,B as _e,a9 as Ae,aa as he,A as Te,r as D,ab as ce,ac as ee,o as $e,R as V,L as C,S as c,M as t,N as m,O as B,T as x,Z as Ee,J as y,X as Be,U as H,V as de,K as A,$ as j,a3 as T,W as Oe,ad as Ye,ae as me,af as Ne,_ as Ue}from"./index-COLuSNnH.js";/* empty css              */import{p as ge,P as He}from"./index-cfsjtYB3.js";/* empty css              *//* empty css              */import{s as Ie,c as Ge}from"./index-CyiIaGJT.js";import{C as Ke}from"./index-BR0IqM1Y.js";import{F as Le}from"./index-BsOY-DgV.js";import{P as ze}from"./index-lh23UwTI.js";import{E as je}from"./index-7ADYuEsa.js";import{S as qe}from"./index-DhMkXSC4.js";/* empty css              */import{N as Xe}from"./index-DtBFF6eJ.js";import{u as Ze}from"./holding-Cj-ioGV6.js";import{searchFund as Je,detectShareClass as We,fetchFundEstimate as Qe,fetchFundFeeInfo as ea,calculateDailyServiceFee as aa}from"./fund-BsJItZTy.js";import{b as O,f as ae,g as I}from"./format-DMY7EWAz.js";import{B as ta}from"./index-dROw2vyl.js";import{s as la}from"./function-call-fsbkCKQc.js";import"./use-id-Bb8U-BO_.js";import"./storage-BvZjhTaj.js";import"./fundFast-BTB3GdVE.js";const[oa]=oe("checkbox-group"),na=Symbol(oa),[sa,ua]=oe("checkbox"),ra=se({},Ge,{shape:String,bindGroup:Re,indeterminate:{type:Boolean,default:null}});var ia=ne({name:sa,props:ra,emits:["change","update:modelValue"],setup(a,{emit:f,slots:s}){const{parent:u}=Se(na),d=p=>{const{name:b}=a,{max:w,modelValue:P}=u.props,_=P.slice();if(p)!(w&&_.length>=+w)&&!_.includes(b)&&(_.push(b),a.bindGroup&&u.updateValue(_));else{const R=_.indexOf(b);R!==-1&&(_.splice(R,1),a.bindGroup&&u.updateValue(_))}},n=S(()=>u&&a.bindGroup?u.props.modelValue.indexOf(a.name)!==-1:!!a.modelValue),r=(p=!n.value)=>{u&&a.bindGroup?d(p):f("update:modelValue",p),a.indeterminate!==null&&f("change",p)};return le(()=>a.modelValue,p=>{a.indeterminate===null&&f("change",p)}),fe({toggle:r,props:a,checked:n}),Me(()=>a.modelValue),()=>v(Ie,pe({bem:ua,role:"checkbox",parent:u,checked:n.value,onToggle:r},a),ye(s,["default","icon"]))}});const ca=_e(ia),da=se({},ge,{modelValue:Ae(),filter:Function,formatter:{type:Function,default:(a,f)=>f}}),ma=Object.keys(ge);function va(a,f){if(a<0)return[];const s=Array(a);let u=-1;for(;++u<a;)s[u]=f(u);return s}const fa=(a,f)=>32-new Date(a,f-1,32).getDate(),te=(a,f,s,u,d,n)=>{const r=va(f-a+1,p=>{const b=he(a+p);return u(s,{text:b,value:b})});return d?d(s,r,n):r},ya=(a,f)=>a.map((s,u)=>{const d=f[u];if(d.length){const n=+d[0].value,r=+d[d.length-1].value;return he(Te(+s,n,r))}return s}),ve=new Date().getFullYear(),[pa]=oe("date-picker"),_a=se({},da,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(ve-10,0,1),validator:ce},maxDate:{type:Date,default:()=>new Date(ve+10,11,31),validator:ce}});var ha=ne({name:pa,props:_a,emits:["confirm","cancel","change","update:modelValue"],setup(a,{emit:f,slots:s}){const u=D(a.modelValue),d=D(!1),n=D(),r=S(()=>d.value?a.modelValue:u.value),p=l=>l===a.minDate.getFullYear(),b=l=>l===a.maxDate.getFullYear(),w=l=>l===a.minDate.getMonth()+1,P=l=>l===a.maxDate.getMonth()+1,_=l=>{const{minDate:h,columnsType:$}=a,Y=$.indexOf(l),E=r.value[Y];if(E)return+E;switch(l){case"year":return h.getFullYear();case"month":return h.getMonth()+1;case"day":return h.getDate()}},R=()=>{const l=a.minDate.getFullYear(),h=a.maxDate.getFullYear();return te(l,h,"year",a.formatter,a.filter,r.value)},F=()=>{const l=_("year"),h=p(l)?a.minDate.getMonth()+1:1,$=b(l)?a.maxDate.getMonth()+1:12;return te(h,$,"month",a.formatter,a.filter,r.value)},k=()=>{const l=_("year"),h=_("month"),$=p(l)&&w(h)?a.minDate.getDate():1,Y=b(l)&&P(h)?a.maxDate.getDate():fa(l,h);return te($,Y,"day",a.formatter,a.filter,r.value)},G=()=>{var l;return(l=n.value)==null?void 0:l.confirm()},q=()=>u.value,K=S(()=>a.columnsType.map(l=>{switch(l){case"year":return R();case"month":return F();case"day":return k();default:return[]}}));le(u,l=>{ee(l,a.modelValue)||f("update:modelValue",l)}),le(()=>a.modelValue,(l,h)=>{d.value=ee(h,u.value),l=ya(l,K.value),ee(l,u.value)||(u.value=l),d.value=!1},{immediate:!0});const L=(...l)=>f("change",...l),X=(...l)=>f("cancel",...l),Z=(...l)=>f("confirm",...l);return fe({confirm:G,getSelectedDate:q}),()=>v(He,pe({ref:n,modelValue:u.value,"onUpdate:modelValue":l=>u.value=l,columns:K.value,onChange:L,onCancel:X,onConfirm:Z},ye(a,ma)),s)}});const ga=_e(ha),ba={class:"holding-page"},Da={key:0,class:"summary-card"},ka={class:"summary-row"},Ca={class:"summary-item"},Fa={class:"summary-value"},Va={class:"summary-item"},xa={class:"summary-row"},wa={class:"summary-item"},Pa={class:"summary-item"},Sa={key:1,class:"list-header"},Ma=["onClick"],Ra={class:"col-name"},Aa={class:"fund-name"},Ta={class:"fund-meta"},$a={class:"amount"},Ea={class:"profit-amount"},Ba={class:"profit-rate"},Oa={class:"add-dialog"},Ya={class:"dialog-header"},Na={class:"dialog-content"},Ua={key:1,class:"search-results"},Ha={class:"share-class-display"},Ia={class:"share-class-desc"},Ga={class:"fee-option"},Ka={class:"fee-rate"},La={key:0,class:"fee-tip"},za={class:"fee-option"},ja={class:"fee-rate"},qa={key:0,class:"fee-tip"},Xa={key:6,class:"calc-result"},Za={class:"calc-item"},Ja={class:"calc-value"},Wa={class:"calc-item"},Qa={class:"calc-value"},et={class:"dialog-footer"},at=ne({__name:"Holding",setup(a){const f=Oe(),s=Ze(),u=D(!1),d=D(!1),n=D({code:"",name:"",amount:"",buyDate:""}),r=D("A"),p=D(null),b=D(!0),w=D(.4),P=D(""),_=D([]),R=D(!1),F=D(null),k=D(0);$e(()=>{s.initHoldings()});const G=S(()=>I(s.summary.totalProfit)),q=S(()=>I(s.summary.todayProfit));async function K(){await s.refreshEstimates(),s.updateHoldingDays(),T("刷新成功")}function L(){d.value=!1,l(),n.value.buyDate=new Date().toISOString().split("T")[0],u.value=!0}function X(i){const e=s.getHoldingByCode(i);e&&(d.value=!0,n.value={code:e.code,name:e.name,amount:e.amount.toString(),buyDate:e.buyDate},k.value=e.buyNetValue,F.value={code:e.code,name:e.name,type:"",pinyin:""},u.value=!0)}async function Z(i){try{await la({title:"确认删除",message:"确定要删除该持仓记录吗？"}),s.removeHolding(i),T("已删除")}catch{}}function l(){n.value={code:"",name:"",amount:"",buyDate:""},P.value="",_.value=[],F.value=null,k.value=0,r.value="A",p.value=null,b.value=!0,w.value=.4}let h=null;function $(){if(h&&clearTimeout(h),!P.value.trim()){_.value=[];return}h=setTimeout(async()=>{R.value=!0;try{_.value=await Je(P.value,10)}finally{R.value=!1}},300)}async function Y(i){F.value=i,n.value.code=i.code,n.value.name=i.name,P.value="",_.value=[],r.value=We(i.code,i.name),Ye({message:"获取净值...",forbidClick:!0});try{const[e,g]=await Promise.all([Qe(i.code),ea(i.code)]);k.value=parseFloat(e.gsz)||parseFloat(e.dwjz)||1,p.value=g,g&&r.value==="C"&&(w.value=g.serviceFeeRate||.4),me()}catch{me();try{const{fetchSimpleKLineData:e}=await Ne(async()=>{const{fetchSimpleKLineData:W}=await import("./fundFast-BTB3GdVE.js");return{fetchSimpleKLineData:W}},__vite__mapDeps([0,1,2])),g=await e(i.code,30);if(g&&g.length>0){k.value=g[g.length-1].value,T("已获取历史净值");return}}catch{}k.value=1,T("请手动输入净值")}}const E=S(()=>{if(r.value!=="A"||!b.value)return 0;const i=parseFloat(n.value.amount)||0,e=p.value?.buyFeeRate||.15,g=i*(e/100);return Math.round(g*100)/100}),J=S(()=>{const i=parseFloat(n.value.amount)||0;return r.value==="A"&&b.value?i-E.value:i}),z=S(()=>J.value<=0||k.value<=0?0:J.value/k.value),ue=S(()=>{if(r.value!=="C")return 0;const i=z.value;return i<=0||k.value<=0?0:aa(i,k.value,w.value)}),re=S(()=>{if(!n.value.buyDate)return 0;const i=new Date(n.value.buyDate),g=new Date().getTime()-i.getTime();return Math.max(0,Math.ceil(g/(1e3*60*60*24)))});async function be(){if(!n.value.code){T("请选择基金");return}if(!n.value.amount||parseFloat(n.value.amount)<=0){T("请输入有效的持仓金额");return}if(!n.value.buyDate){T("请选择买入日期");return}const i={code:n.value.code,name:n.value.name,shareClass:r.value,amount:parseFloat(n.value.amount),buyNetValue:k.value,shares:z.value,buyDate:n.value.buyDate,holdingDays:re.value,createdAt:Date.now(),buyFeeRate:r.value==="A"?p.value?.buyFeeRate||.15:void 0,buyFeeDeducted:r.value==="A"?b.value:void 0,buyFeeAmount:r.value==="A"?E.value:void 0,serviceFeeRate:r.value==="C"?w.value:void 0,serviceFeeDeducted:r.value==="C"?0:void 0,lastFeeDate:r.value==="C"?n.value.buyDate:void 0};await s.addOrUpdateHolding(i),T(d.value?"修改成功":"添加成功"),u.value=!1,l()}function De(i){f.push(`/detail/${i}`)}const N=D(!1);function ke({selectedValues:i}){i.length>=3&&(n.value.buyDate=i.join("-")),N.value=!1}return(i,e)=>{const g=Be,W=Xe,U=ta,Ce=qe,Fe=je,Ve=ze,M=Le,xe=Ke,we=ca,ie=Ee,Pe=ga;return y(),V("div",ba,[v(W,{title:"我的持仓"},{right:C(()=>[v(g,{name:"add-o",size:"20",onClick:L})]),_:1}),c(s).holdings.length>0?(y(),V("div",Da,[t("div",ka,[t("div",Ca,[e[11]||(e[11]=t("div",{class:"summary-label"},"账户资产",-1)),t("div",Fa,m(c(O)(c(s).summary.totalValue)),1)]),t("div",Va,[e[12]||(e[12]=t("div",{class:"summary-label"},"当日收益",-1)),t("div",{class:B(["summary-value",q.value])},m(c(s).summary.todayProfit>=0?"+":"")+m(c(O)(c(s).summary.todayProfit)),3)])]),t("div",xa,[t("div",wa,[e[13]||(e[13]=t("div",{class:"summary-label"},"持仓盈亏",-1)),t("div",{class:B(["summary-value",G.value])},m(c(s).summary.totalProfit>=0?"+":"")+m(c(O)(c(s).summary.totalProfit)),3)]),t("div",Pa,[e[14]||(e[14]=t("div",{class:"summary-label"},"收益率",-1)),t("div",{class:B(["summary-value",G.value])},m(c(ae)(c(s).summary.totalProfitRate)),3)])])])):x("",!0),c(s).holdings.length>0?(y(),V("div",Sa,[...e[15]||(e[15]=[t("span",{class:"col-name"},"基金名称",-1),t("span",{class:"col-change"},"当日涨幅",-1),t("span",{class:"col-today"},"当日收益",-1),t("span",{class:"col-profit"},"持有收益",-1)])])):x("",!0),v(Ve,{modelValue:c(s).isRefreshing,"onUpdate:modelValue":e[0]||(e[0]=o=>c(s).isRefreshing=o),onRefresh:K,class:"holding-list-container"},{default:C(()=>[c(s).holdings.length>0?(y(!0),V(H,{key:0},de(c(s).holdings,o=>(y(),A(Ce,{key:o.code},{right:C(()=>[v(U,{square:"",type:"primary",text:"编辑",class:"action-btn",onClick:Q=>X(o.code)},null,8,["onClick"]),v(U,{square:"",type:"danger",text:"删除",class:"action-btn",onClick:Q=>Z(o.code)},null,8,["onClick"])]),default:C(()=>[t("div",{class:"holding-item",onClick:Q=>De(o.code)},[t("div",Ra,[t("div",Aa,m(o.name||"加载中..."),1),t("div",Ta,[e[16]||(e[16]=t("span",{class:"tag"},"已更新",-1)),t("span",$a,"¥"+m(c(O)(o.amount)),1)])]),t("div",{class:B(["col-change",c(I)(o.todayChange||0)])},m(c(ae)(o.todayChange||0)),3),t("div",{class:B(["col-today",c(I)(o.todayProfit||0)])},m(o.todayProfit!==void 0?(o.todayProfit>=0?"+":"")+c(O)(o.todayProfit):"--"),3),t("div",{class:B(["col-profit",c(I)(o.profit||0)])},[t("div",Ea,m(o.profit!==void 0?(o.profit>=0?"+":"")+c(O)(o.profit):"--"),1),t("div",Ba,m(o.profitRate!==void 0?c(ae)(o.profitRate):"--"),1)],2)],8,Ma)]),_:2},1024))),128)):(y(),A(Fe,{key:1,description:"暂无持仓记录"},{default:C(()=>[v(U,{round:"",type:"primary",onClick:L},{default:C(()=>[...e[17]||(e[17]=[j(" 添加持仓 ",-1)])]),_:1})]),_:1}))]),_:1},8,["modelValue"]),v(ie,{show:u.value,"onUpdate:show":e[8]||(e[8]=o=>u.value=o),position:"bottom",round:"",style:{height:"75%"}},{default:C(()=>[t("div",Oa,[t("div",Ya,[t("span",null,m(d.value?"编辑持仓":"添加持仓"),1),v(g,{name:"cross",onClick:e[1]||(e[1]=o=>u.value=!1)})]),t("div",Na,[d.value?(y(),A(M,{key:1,"model-value":`${n.value.name} (${n.value.code})`,label:"基金",readonly:""},null,8,["model-value"])):(y(),V(H,{key:0},[F.value?x("",!0):(y(),A(M,{key:0,modelValue:P.value,"onUpdate:modelValue":e[2]||(e[2]=o=>P.value=o),label:"选择基金",placeholder:"输入基金代码或名称搜索",onInput:$},null,8,["modelValue"])),_.value.length>0?(y(),V("div",Ua,[(y(!0),V(H,null,de(_.value,o=>(y(),A(xe,{key:o.code,title:o.name,label:o.code,clickable:"",onClick:Q=>Y(o)},null,8,["title","label","onClick"]))),128))])):x("",!0),F.value?(y(),A(M,{key:2,"model-value":`${F.value.name} (${F.value.code})`,label:"已选基金",readonly:""},{button:C(()=>[v(U,{size:"small",onClick:e[3]||(e[3]=o=>{F.value=null,k.value=0})},{default:C(()=>[...e[18]||(e[18]=[j("重选",-1)])]),_:1})]),_:1},8,["model-value"])):x("",!0)],64)),k.value>0?(y(),A(M,{key:2,"model-value":k.value.toFixed(4),label:"当前净值",readonly:""},null,8,["model-value"])):x("",!0),F.value||d.value?(y(),A(M,{key:3,label:"份额类型",readonly:""},{input:C(()=>[t("div",Ha,[t("span",{class:B(["share-class-tag",r.value.toLowerCase()])},m(r.value)+"类",3),t("span",Ia,m(r.value==="A"?"前端收费":"按日计提销售服务费"),1)])]),_:1})):x("",!0),r.value==="A"&&(F.value||d.value)?(y(),V(H,{key:4},[v(M,{label:"买入手续费"},{input:C(()=>[t("div",Ga,[v(we,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=o=>b.value=o),shape:"square"},{default:C(()=>[...e[19]||(e[19]=[j(" 从金额中扣除 ",-1)])]),_:1},8,["modelValue"]),t("span",Ka,"费率 "+m(p.value?.buyFeeRate||.15)+"%",1)])]),_:1}),E.value>0?(y(),V("div",La,[v(g,{name:"info-o"}),t("span",null,"手续费约 ¥"+m(E.value.toFixed(2))+"，实际买入 ¥"+m(J.value.toFixed(2)),1)])):x("",!0)],64)):x("",!0),r.value==="C"&&(F.value||d.value)?(y(),V(H,{key:5},[v(M,{label:"销售服务费"},{input:C(()=>[t("div",za,[t("span",ja,"年化 "+m(w.value)+"%（按日计提）",1)])]),_:1}),ue.value>0?(y(),V("div",qa,[v(g,{name:"info-o"}),t("span",null,"每日约扣 ¥"+m(ue.value.toFixed(2))+"（不满1分按1分计）",1)])):x("",!0)],64)):x("",!0),v(M,{modelValue:n.value.amount,"onUpdate:modelValue":e[5]||(e[5]=o=>n.value.amount=o),type:"number",label:"持仓金额",placeholder:"请输入持仓金额（元）"},null,8,["modelValue"]),v(M,{modelValue:n.value.buyDate,"onUpdate:modelValue":e[6]||(e[6]=o=>n.value.buyDate=o),label:"买入日期",placeholder:"请选择买入日期",readonly:"","is-link":"",onClick:e[7]||(e[7]=o=>N.value=!0)},null,8,["modelValue"]),z.value>0?(y(),V("div",Xa,[t("div",Za,[e[20]||(e[20]=t("span",{class:"calc-label"},"预估份额",-1)),t("span",Ja,m(z.value.toFixed(2))+" 份",1)]),t("div",Wa,[e[21]||(e[21]=t("span",{class:"calc-label"},"持仓天数",-1)),t("span",Qa,m(re.value)+" 天",1)])])):x("",!0)]),t("div",et,[v(U,{block:"",type:"primary",onClick:be},{default:C(()=>[j(m(d.value?"保存修改":"确认添加"),1)]),_:1})])])]),_:1},8,["show"]),v(ie,{show:N.value,"onUpdate:show":e[10]||(e[10]=o=>N.value=o),position:"bottom"},{default:C(()=>[v(Pe,{title:"选择买入日期","max-date":new Date,onConfirm:ke,onCancel:e[9]||(e[9]=o=>N.value=!1)},null,8,["max-date"])]),_:1},8,["show"])])}}}),Ct=Ue(at,[["__scopeId","data-v-485dd987"]]);export{Ct as default};
