import{I as x,r as D,p as i}from"./index-COLuSNnH.js";const f="fund_trades";function I(){return`trade_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}function V(){try{const t=localStorage.getItem(f);return t?JSON.parse(t):[]}catch{return[]}}function o(t){localStorage.setItem(f,JSON.stringify(t))}const B=x("trade",()=>{const t=D(V()),s=i(()=>[...t.value].sort((e,n)=>new Date(n.date).getTime()-new Date(e.date).getTime()));function c(e){return s.value.filter(n=>n.code===e)}function v(e){const n=c(e);let a=0,r=0,d=0;for(const u of n)switch(u.type){case"buy":case"auto_invest":a+=u.shares,r+=u.amount+u.fee;break;case"sell":const w=u.shares/a;r-=r*w,a-=u.shares;break;case"dividend":d+=u.amount;break}return{shares:Math.max(0,a),cost:Math.max(0,r),avgCost:a>0?r/a:0,dividend:d}}const h=i(()=>{let e=0,n=0,a=0,r=0;for(const d of t.value)switch(a+=d.fee,d.type){case"buy":case"auto_invest":e+=d.amount;break;case"sell":n+=d.amount;break;case"dividend":r+=d.amount;break}return{totalBuy:e,totalSell:n,totalFee:a,totalDividend:r,netInvest:e-n}});function l(e){const n={...e,id:I(),createdAt:Date.now()};return t.value.push(n),o(t.value),n}function T(e){const n=e.amount/e.netValue;return l({code:e.code,name:e.name,type:"buy",date:e.date,amount:e.amount,netValue:e.netValue,shares:n,fee:e.fee||0,remark:e.remark})}function y(e){const n=e.shares*e.netValue;return l({code:e.code,name:e.name,type:"sell",date:e.date,amount:n,netValue:e.netValue,shares:e.shares,fee:e.fee||0,remark:e.remark})}function g(e){return l({code:e.code,name:e.name,type:"dividend",date:e.date,amount:e.amount,netValue:0,shares:0,fee:0,remark:e.remark})}function m(e,n){const a=t.value.findIndex(r=>r.id===e);return a===-1?!1:(t.value[a]={...t.value[a],...n},o(t.value),!0)}function k(e){const n=t.value.findIndex(a=>a.id===e);return n===-1?!1:(t.value.splice(n,1),o(t.value),!0)}function S(e){const n=t.value.length;return t.value=t.value.filter(a=>a.code!==e),o(t.value),n-t.value.length}function b(){t.value=[],o(t.value)}return{trades:t,sortedTrades:s,statistics:h,getTradesByFund:c,calculateHolding:v,addTrade:l,addBuyTrade:T,addSellTrade:y,addDividendTrade:g,updateTrade:m,deleteTrade:k,deleteTradesByFund:S,clearAllTrades:b}});export{B as u};
