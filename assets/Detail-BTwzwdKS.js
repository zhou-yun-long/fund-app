import{d as Ne,ao as Ye,w as be,o as Oe,at as Be,R as o,M as e,U as Q,V as Z,N as a,O as k,k as z,a2 as He,L as Xe,T as P,r as w,p as j,au as Ue,J as n,P as Ke,$ as Se,v as Pe,_ as je,af as qe,av as Ge,aw as Je,a6 as Qe,ax as Ze,ay as et,az as tt,aA as st,a3 as de,ap as at,a0 as Re,a1 as ze,K as We,a8 as Fe,S as Ve,X as lt,W as nt,as as ot,aB as it}from"./index-COLuSNnH.js";import{E as ct}from"./index-7ADYuEsa.js";/* empty css              */import{u as dt}from"./fund-qjlmdvOA.js";import{u as rt}from"./holding-Cj-ioGV6.js";import{detectShareClass as Le,fetchStockHoldings as ut}from"./fund-BsJItZTy.js";import{clearFundCache as vt,fetchSimpleKLineData as mt,calculatePeriodReturns as ht,fetchFundEstimateFast as Ee,fetchIndustryAllocation as pt,fetchAssetAllocation as ft,fetchFundRating as gt}from"./fundFast-BTB3GdVE.js";import{s as _t}from"./function-call-fsbkCKQc.js";import"./use-id-Bb8U-BO_.js";import"./storage-BvZjhTaj.js";import"./index-dROw2vyl.js";const yt={class:"pro-chart"},bt={class:"period-selector"},xt=["onClick"],kt={class:"ohlc-bar"},wt={class:"ohlc-item"},Ct={class:"ohlc-value"},Ft={class:"ohlc-item"},St={class:"ohlc-value up"},$t={class:"ohlc-item"},Dt={class:"ohlc-value down"},Tt={class:"ohlc-item"},Pt={class:"ohlc-item"},Rt={class:"chart-container"},zt={key:0,class:"chart-loading"},Mt={class:"volume-label"},At={class:"volume-value"},It={key:0,class:"returns-bar"},Vt={class:"return-label"},Wt=Ne({__name:"OKXChart",props:{fundCode:{},realtimeValue:{},realtimeChange:{},lastClose:{}},setup($e){const g=$e,K=Ye();function ee(){const c=K.actualTheme==="dark";return{bgPrimary:c?"#0b0e11":"#ffffff",bgSecondary:c?"#1e2329":"#f5f5f5",textPrimary:c?"#eaecef":"#1a1a1a",textSecondary:c?"#848e9c":"#666666",borderColor:c?"#2b3139":"#e0e0e0",gridColor:c?"#1e2329":"#f0f0f0",upColor:"#f6465d",downColor:"#0ecb81"}}const me=w([]),v=w([]),y=w(!1),q=w("5d"),ae=w(null),O=w([]),V=w(0),he=[{key:"1d",label:"当日",days:0},{key:"5d",label:"5日",days:5},{key:"1m",label:"1月",days:30},{key:"3m",label:"3月",days:90},{key:"6m",label:"6月",days:180},{key:"1y",label:"1年",days:365}],le=j(()=>q.value==="1d"),te=j(()=>le.value),W=j(()=>{const c=q.value,s=new Date,r=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`;if(te.value){const p=[...me.value].sort((ie,ge)=>new Date(ie.time).getTime()-new Date(ge.time).getTime());if(p.length===0)return[{time:r,value:g.lastClose||g.realtimeValue||1,change:0,volume:50}];const d=p[p.length-1],X=d.time===r,D=X&&p.length>1?p[p.length-2]:d;let oe=[{time:D.time,value:D.value,change:D.change,volume:60}];if(g.realtimeValue>0){const ie=(g.realtimeValue-D.value)/D.value*100;oe=[...oe,{time:r,value:g.realtimeValue,change:g.realtimeChange||Number(ie.toFixed(2)),volume:80}]}else X&&(oe=[...oe,{time:d.time,value:d.value,change:d.change,volume:80}]);return oe}const b=he.find(p=>p.key===c),L=b?.days===0||!b?5:b.days,G=new Date(s.getTime()-L*24*60*60*1e3);let A=[...me.value].sort((p,d)=>new Date(p.time).getTime()-new Date(d.time).getTime()).filter(p=>new Date(p.time)>=G).map((p,d)=>({...p,volume:50+Math.abs(p.change)*30+d%5*10}));if(g.realtimeValue>0&&A.length>0){const p=A.length-1,d=A[p];d.time===r?A=[...A.slice(0,p),{...d,value:g.realtimeValue,change:g.realtimeChange,volume:d.volume}]:A=[...A,{time:r,value:g.realtimeValue,change:g.realtimeChange,volume:50+Math.abs(g.realtimeChange)*30}]}return A}),ne=j(()=>le.value&&V.value>0&&g.realtimeValue>0?(g.realtimeValue-V.value)/V.value*100:g.realtimeChange||0),B=j(()=>{const c=W.value;if(c.length===0)return{open:0,high:0,low:0,close:0};const s=c.map(r=>r.value);return{open:c[0]?.value||0,high:Math.max(...s),low:Math.min(...s),close:c[c.length-1]?.value||0}});function re(c){if(!c||c<=0)return;const s=new Date,r=`${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}:${s.getSeconds().toString().padStart(2,"0")}`;V.value===0&&(V.value=g.lastClose||c);const b=O.value.length>0?O.value[O.value.length-1].value:c,G=100+Math.abs(c-b)*1e4+Math.random()*50,A=500;O.value.length>=A&&(O.value=O.value.slice(-A+1)),O.value.push({time:r,value:c,volume:G})}function M(){O.value=[],V.value=g.lastClose||0}async function H(){if(g.fundCode){y.value=!0;try{vt(g.fundCode);const[c,s]=await Promise.all([mt(g.fundCode,400),ht(g.fundCode)]);me.value=c,v.value=s,await Pe(),Y()}catch(c){console.error("加载图表数据失败:",c)}finally{y.value=!1}}}function Y(){const c=ae.value;if(!c){setTimeout(Y,50);return}const s=c.getContext("2d");if(!s)return;const r=W.value;if(r.length===0)return;const b=window.devicePixelRatio||1,L=c.getBoundingClientRect();if(L.width===0||L.height===0){setTimeout(Y,50);return}c.width=L.width*b,c.height=L.height*b,s.scale(b,b);const G=L.width,A=L.height;let p;p=A-25;const d={top:15,right:60,left:55},X=G-d.left-d.right,D=ee();s.fillStyle=D.bgPrimary,s.fillRect(0,0,G,A);const oe=r.map(u=>u.value);let U=Math.min(...oe),ie=Math.max(...oe);const ge=(ie-U)*.1||.01;U-=ge,ie+=ge;const ce=ie-U||1,Me=r.map(u=>u.volume||0);Math.max(...Me,1),s.strokeStyle=D.gridColor,s.lineWidth=1;for(let u=0;u<=4;u++){const T=d.top+(p-d.top)*u/4;s.beginPath(),s.moveTo(d.left,T),s.lineTo(G-d.right,T),s.stroke()}s.fillStyle=D.textSecondary,s.font="10px Arial",s.textAlign="left";for(let u=0;u<=4;u++){const T=ie-ce*u/4,_=d.top+(p-d.top)*u/4;s.fillText(T.toFixed(4),G-d.right+5,_+3)}ne.value>=0;const fe=D.upColor,ke=D.downColor,we=p,Ae=r[0]?.value||0,E=(r[r.length-1]?.value||0)>=Ae,i=new Date,t=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`,m=Ue(),R=g.realtimeValue>0,J=le.value&&m&&!R;if(le.value&&r.length>0&&J){s.beginPath(),s.setLineDash([4,4]),r.forEach(($,x)=>{const N=d.left+X/Math.max(r.length-1,1)*x,I=d.top+(p-d.top)*(1-($.value-U)/ce);x===0?s.moveTo(N,I):s.lineTo(N,I)}),s.strokeStyle=D.textSecondary,s.lineWidth=1.5,s.stroke(),s.setLineDash([]),r.forEach(($,x)=>{const N=d.left+X/Math.max(r.length-1,1)*x,I=d.top+(p-d.top)*(1-($.value-U)/ce);s.beginPath(),s.arc(N,I,3,0,Math.PI*2),s.fillStyle=D.textSecondary,s.fill()});const u=r[r.length-1],T=d.left+X,_=d.top+(p-d.top)*(1-(u.value-U)/ce);s.beginPath(),s.setLineDash([4,4]);const F=d.left+X/Math.max(r.length-1,1)*(r.length-1),h=d.top+(p-d.top)*(1-(u.value-U)/ce);s.moveTo(F,h),s.lineTo(T,_),s.strokeStyle=D.textSecondary,s.lineWidth=1,s.stroke(),s.setLineDash([]),s.fillStyle=D.textSecondary,s.font="12px Arial",s.textAlign="center",s.fillText("等待开盘",T-40,_-10);const S=3+Math.sin(Date.now()/300)*1.5;s.beginPath(),s.arc(T,_,S,0,Math.PI*2),s.fillStyle=D.textSecondary,s.globalAlpha=.5+Math.sin(Date.now()/300)*.3,s.fill(),s.globalAlpha=1}else{s.beginPath(),s.moveTo(d.left,we);const u=r.map((h,S)=>({x:d.left+X/Math.max(r.length-1,1)*S,y:d.top+(p-d.top)*(1-(h.value-U)/ce)}));if(u.length>0)if(s.lineTo(u[0].x,u[0].y),u.length<3)for(let h=1;h<u.length;h++)s.lineTo(u[h].x,u[h].y);else for(let h=0;h<u.length-1;h++){const S=u[Math.max(h-1,0)],$=u[h],x=u[h+1],N=u[Math.min(h+2,u.length-1)],I=6,_e=$.x+(x.x-S.x)/I,Te=$.y+(x.y-S.y)/I,Ce=x.x-(N.x-$.x)/I,ye=x.y-(N.y-$.y)/I;s.bezierCurveTo(_e,Te,Ce,ye,x.x,x.y)}const T=d.left+X;s.lineTo(T,we),s.closePath();const _=s.createLinearGradient(0,d.top,0,we);E?(_.addColorStop(0,"rgba(246, 70, 93, 0.25)"),_.addColorStop(.5,"rgba(246, 70, 93, 0.1)"),_.addColorStop(1,"rgba(246, 70, 93, 0)")):(_.addColorStop(0,"rgba(14, 203, 129, 0.25)"),_.addColorStop(.5,"rgba(14, 203, 129, 0.1)"),_.addColorStop(1,"rgba(14, 203, 129, 0)")),s.fillStyle=_,s.fill(),s.beginPath();const F=r.map((h,S)=>({x:d.left+X/Math.max(r.length-1,1)*S,y:d.top+(p-d.top)*(1-(h.value-U)/ce)}));if(F.length>0)if(s.moveTo(F[0].x,F[0].y),F.length<3)for(let h=1;h<F.length;h++)s.lineTo(F[h].x,F[h].y);else for(let h=0;h<F.length-1;h++){const S=F[Math.max(h-1,0)],$=F[h],x=F[h+1],N=F[Math.min(h+2,F.length-1)],I=6,_e=$.x+(x.x-S.x)/I,Te=$.y+(x.y-S.y)/I,Ce=x.x-(N.x-$.x)/I,ye=x.y-(N.y-$.y)/I;s.bezierCurveTo(_e,Te,Ce,ye,x.x,x.y)}if(s.strokeStyle=E?fe:ke,s.lineWidth=2,s.stroke(),r.length>0){const h=r[r.length-1],S=d.left+X,$=d.top+(p-d.top)*(1-(h.value-U)/ce),x=3+Math.sin(Date.now()/200)*1.5;s.beginPath(),s.arc(S,$,x,0,Math.PI*2),s.fillStyle=E?fe:ke,s.fill(),s.beginPath(),s.arc(S,$,x+3,0,Math.PI*2),s.strokeStyle=E?fe:ke,s.lineWidth=1,s.globalAlpha=.4,s.stroke(),s.globalAlpha=1;const N=h.value.toFixed(4);s.font="bold 11px Arial";const I=$<p/2?$+18:$-8,_e=S+5,Ce=s.measureText(N).width,ye=14,Ie=3;s.fillStyle=E?"rgba(246, 70, 93, 0.9)":"rgba(14, 203, 129, 0.9)",s.beginPath(),s.roundRect(_e-Ie,I-ye+2,Ce+Ie*2,ye+Ie,3),s.fill(),s.fillStyle="#ffffff",s.textAlign="left",s.fillText(N,_e,I)}}s.fillStyle=D.textSecondary,s.font="10px Arial",s.textAlign="center";const l=G<350?3:G<450?4:5,C=Math.min(l,r.length);for(let u=0;u<C;u++){const T=Math.floor((r.length-1)*u/Math.max(C-1,1)),_=r[T];if(!_)continue;const F=d.left+X/Math.max(r.length-1,1)*T;let h;if(le.value&&_.time.includes(" "))h=_.time.split(" ")[1]||_.time.slice(-5);else{const S=_.time.split("-");h=S.length>=3?`${S[1]}-${S[2].split(" ")[0]}`:_.time.slice(-5)}s.fillText(h,F,A-5)}if(le.value&&r.length>0){const u=r[0],T=u.time.split(" ")[0]||u.time,_=T.split("-"),F=_.length>=3?`${_[1]}-${_[2]}`:T;T.includes(t)||(s.font="11px Arial",s.textAlign="left",s.fillStyle=D.textSecondary,s.fillText(`最新交易日: ${F}`,d.left,d.top-3))}}function se(c){return c>=1e6?(c/1e6).toFixed(1)+"M":c>=1e3?(c/1e3).toFixed(1)+"K":c.toFixed(0)}function pe(c){if(De(),c==="1d"){M();const s=g.realtimeValue||g.lastClose||1;s>0&&re(s)}q.value=c,Pe(()=>{Y(),f()})}let ve=null;function f(){if(ve)return;let c=0;function s(r){r-c>33&&(c=r,Y()),ve=requestAnimationFrame(s)}ve=requestAnimationFrame(s)}function De(){ve&&(cancelAnimationFrame(ve),ve=null)}be(()=>g.fundCode,()=>{M(),H()},{immediate:!0}),be(()=>g.realtimeValue,c=>{c&&c>0&&le.value&&re(c)}),be(()=>g.lastClose,c=>{c&&c>0&&V.value===0&&(V.value=c)}),be(q,()=>{Pe(Y)}),be(()=>K.actualTheme,()=>{Pe(Y)});let xe=null;return Oe(()=>{ae.value&&(xe=new ResizeObserver(()=>Y()),xe.observe(ae.value.parentElement)),g.realtimeValue>0&&re(g.realtimeValue),setTimeout(f,500)}),Be(()=>{De(),xe?.disconnect()}),(c,s)=>{const r=He;return n(),o("div",yt,[e("div",bt,[(n(),o(Q,null,Z(he,b=>e("div",{key:b.key,class:k(["period-btn",{active:q.value===b.key}]),onClick:Ke(L=>pe(b.key),["stop"])},a(b.label),11,xt)),64)),s[0]||(s[0]=e("div",{class:"period-tools"},[e("span",{class:"tool-label"},"实时"),e("span",{class:"live-dot"})],-1))]),e("div",kt,[e("span",wt,[s[1]||(s[1]=e("span",{class:"ohlc-label"},"开",-1)),e("span",Ct,a(B.value.open.toFixed(4)),1)]),e("span",Ft,[s[2]||(s[2]=e("span",{class:"ohlc-label"},"高",-1)),e("span",St,a(B.value.high.toFixed(4)),1)]),e("span",$t,[s[3]||(s[3]=e("span",{class:"ohlc-label"},"低",-1)),e("span",Dt,a(B.value.low.toFixed(4)),1)]),e("span",Tt,[s[4]||(s[4]=e("span",{class:"ohlc-label"},"收",-1)),e("span",{class:k(["ohlc-value",ne.value>=0?"up":"down"])},a($e.realtimeValue>0?$e.realtimeValue.toFixed(4):B.value.close.toFixed(4)),3)]),e("span",Pt,[s[5]||(s[5]=e("span",{class:"ohlc-label"},"涨跌",-1)),e("span",{class:k(["ohlc-value",ne.value>=0?"up":"down"])},a(ne.value>=0?"+":"")+a(ne.value.toFixed(2))+"% ",3)])]),e("div",Rt,[y.value?(n(),o("div",zt,[z(r,{size:"24px",color:"#0ecb81"},{default:Xe(()=>[...s[6]||(s[6]=[Se("加载中...",-1)])]),_:1})])):(n(),o("canvas",{key:1,ref_key:"canvasRef",ref:ae,class:"chart-canvas"},null,512))]),e("div",Mt,[s[7]||(s[7]=e("span",null,"成交量(Volume)",-1)),e("span",At,a(se(W.value[W.value.length-1]?.volume||0)),1)]),v.value.length>0?(n(),o("div",It,[(n(!0),o(Q,null,Z(v.value,b=>(n(),o("div",{key:b.period,class:"return-item"},[e("span",Vt,a(b.label),1),e("span",{class:k(["return-value",b.change>=0?"up":"down"])},a(b.change>=0?"+":"")+a(b.change.toFixed(2))+"% ",3)]))),128))])):P("",!0)])}}}),Lt=je(Wt,[["__scopeId","data-v-faae9973"]]),Et={class:"detail-page"},Nt={class:"top-header"},Ot={class:"nav-bar"},Bt={class:"nav-title"},Ht={class:"fund-name"},Xt={class:"fund-code"},jt={key:0,class:"core-metrics"},Yt={class:"main-change"},Ut={class:"change-label"},Kt={class:"sub-metrics"},qt={class:"metric-item"},Gt={class:"metric-value"},Jt={class:"metric-item"},Qt={class:"metric-value"},Zt={class:"metric-item"},es={class:"metric-label"},ts={key:1,class:"core-metrics loading"},ss={class:"summary-item"},as={class:"summary-value"},ls={class:"summary-item"},ns={class:"summary-item"},os={class:"holding-grid"},is={class:"holding-item"},cs={class:"item-value"},ds={class:"holding-item"},rs={class:"item-value"},us={class:"holding-item"},vs={class:"item-value"},ms={class:"holding-item"},hs={class:"holding-item"},ps={class:"holding-item"},fs={class:"item-value"},gs={class:"holding-item"},_s={class:"holding-item"},ys={class:"holding-item"},bs={class:"item-value"},xs={class:"tab-bar"},ks={class:"chart-section"},ws={class:"chart-header"},Cs={class:"data-source"},Fs={class:"performance-section"},Ss={key:0,class:"period-grid"},$s={class:"period-label"},Ds={key:0,class:"period-rank"},Ts={class:"rank-num"},Ps={class:"profit-section"},Rs={key:0,class:"profit-chart"},zs={class:"profit-summary"},Ms={class:"profit-total"},As={class:"profit-rate"},Is={class:"sector-info"},Vs={class:"sector-name"},Ws={class:"sector-link"},Ls={key:2,class:"similar-section"},Es={class:"similar-list"},Ns=["onClick"],Os={class:"similar-info"},Bs={class:"similar-name"},Hs={class:"similar-code"},Xs={key:3,class:"info-section"},js={class:"section-header"},Ys={class:"section-tip"},Us={class:"scale-grid"},Ks={class:"scale-item"},qs={class:"scale-value"},Gs={class:"scale-item"},Js={class:"scale-value"},Qs={class:"scale-item"},Zs={class:"scale-value"},ea={class:"scale-item"},ta={class:"scale-value"},sa={key:4,class:"info-section"},aa={class:"fee-grid"},la={class:"fee-item"},na={class:"fee-value"},oa={class:"fee-item"},ia={class:"fee-value"},ca={key:0,class:"fee-item"},da={class:"fee-value"},ra={class:"fee-table"},ua={class:"discount"},va={class:"fee-table"},ma={key:0,class:"redemption-estimate"},ha={class:"estimate-info"},pa={class:"estimate-fee"},fa={class:"fee-amount"},ga={class:"info-section"},_a={class:"section-header"},ya={key:0,class:"section-tip"},ba={key:0,class:"holdings-list"},xa={class:"holding-rank"},ka={class:"holding-info"},wa={class:"holding-name"},Ca={class:"holding-code"},Fa={class:"holding-ratio"},Sa={class:"ratio-value"},$a={key:1,class:"empty-hint"},Da={key:5,class:"info-section"},Ta={class:"industry-chart"},Pa={class:"pie-container"},Ra={viewBox:"0 0 100 100",class:"pie-svg"},za=["stroke","stroke-dasharray","stroke-dashoffset"],Ma={class:"industry-legend"},Aa={class:"legend-name"},Ia={class:"legend-value"},Va={key:6,class:"info-section"},Wa={class:"asset-bars"},La={key:0,class:"asset-item"},Ea={class:"asset-bar"},Na={class:"asset-value"},Oa={key:1,class:"asset-item"},Ba={class:"asset-bar"},Ha={class:"asset-value"},Xa={key:2,class:"asset-item"},ja={class:"asset-bar"},Ya={class:"asset-value"},Ua={key:3,class:"asset-item"},Ka={class:"asset-bar"},qa={class:"asset-value"},Ga={key:7,class:"info-section"},Ja={class:"section-header"},Qa={class:"section-tip"},Za={class:"rating-content"},el={class:"rating-stars"},tl={class:"rating-text"},sl={class:"rating-metrics"},al={class:"metric-item"},ll={class:"metric-value"},nl={class:"metric-item"},ol={class:"metric-value danger"},il={class:"metric-item"},cl={class:"metric-value"},dl={class:"metric-item"},rl={class:"metric-value primary"},ul={class:"info-section"},vl={class:"section-header"},ml={key:0,class:"section-tip"},hl={key:0,class:"dividend-list"},pl={class:"dividend-date"},fl={class:"dividend-amount"},gl={class:"dividend-type"},_l={key:0,class:"more-hint"},yl={key:1,class:"empty-hint"},bl={class:"info-section"},xl={key:0,class:"announcement-list"},kl=["onClick"],wl={class:"announcement-content"},Cl={class:"announcement-title"},Fl={class:"announcement-date"},Sl={key:1,class:"empty-hint"},$l={class:"bottom-bar"},Dl=Ne({__name:"Detail",setup($e){const g=ot(),K=nt(),ee=dt(),me=rt(),v=j(()=>g.params.code),y=w(null),q=w([]),ae=w([]),O=w([]),V=w(null),he=w(!0),le=w("A"),te=w([]),W=w(null),ne=w([]),B=w(null),re=w([]),M=w(null),H=w(null);let Y=null;const se=w("chart"),pe=w(!0),ve=j(()=>me.holdings.find(i=>i.code===v.value)||null),f=j(()=>{const i=ve.value;if(!i)return null;const t=parseFloat(y.value?.gsz||y.value?.dwjz||"0"),m=i.shares||0,R=i.buyNetValue||0,J=i.amount||0,l=m*t,C=l-J,u=J>0?C/J*100:0,T=me.summary.totalValue||1,_=l/T*100,F=new Date(i.buyDate||Date.now()),S=Math.floor((new Date().getTime()-F.getTime())/(1e3*60*60*24)),$=parseFloat(y.value?.gszzl||"0"),x=l*($/100),N=C-x;return{amount:l,shares:m,ratio:_,profit:C,profitRate:u,cost:R,todayProfit:x,yesterdayProfit:N,holdDays:S}});Oe(async()=>{me.initHoldings(),await s(),De()}),be(v,async(i,t)=>{i&&i!==t&&(y.value=null,q.value=[],ae.value=[],O.value=[],te.value=[],W.value=null,ne.value=[],B.value=null,he.value=!0,await s())}),Be(()=>{xe()});function De(){Y=setInterval(async()=>{const i=new Date,t=i.getHours(),m=i.getMinutes(),R=i.getDay();R===0||R===6||t<9||t>15||t===9&&m<30||await c()},3e3)}function xe(){Y&&(clearInterval(Y),Y=null)}async function c(){try{const i=await Ee(v.value);i&&(y.value=i)}catch{}}async function s(){he.value=!0;try{const i=await Ee(v.value).catch(()=>null);if(i)y.value=i,le.value=Le(v.value,i.name);else{const{searchFund:t}=await qe(async()=>{const{searchFund:R}=await import("./fund-BsJItZTy.js");return{searchFund:R}},[]),m=await t(v.value,1);m.length>0?(y.value={fundcode:v.value,name:m[0].name,dwjz:"0",gsz:"0",gszzl:"0",gztime:"--"},le.value=Le(v.value,m[0].name)):y.value={fundcode:v.value,name:`基金 ${v.value}`,dwjz:"0",gsz:"0",gszzl:"0",gztime:"--"}}ut(v.value).then(t=>q.value=t).catch(()=>{}),Ge(v.value).then(t=>ae.value=t).catch(()=>{}),Je(v.value).then(t=>O.value=t).catch(()=>{}),Qe().then(t=>{t.length>0&&(V.value=t[0])}).catch(()=>{}),pt(v.value).then(t=>re.value=t).catch(()=>{}),ft(v.value).then(t=>M.value=t).catch(()=>{}),gt(v.value).then(t=>H.value=t).catch(()=>{}),Ze(v.value).then(t=>te.value=t).catch(()=>{}),et(v.value).then(t=>W.value=t).catch(()=>{}),tt(v.value).then(t=>ne.value=t).catch(()=>{}),st(v.value).then(t=>B.value=t).catch(()=>{})}catch{de("加载失败")}finally{he.value=!1}}const r=j(()=>parseFloat(y.value?.gszzl||"0")||0),b=j(()=>r.value>=0),L=j(()=>{const i=["1y","6m","3m","1m"];for(const t of i){const m=ae.value.find(R=>R.period===t);if(m&&m.fundReturn!==0)return{label:{"1y":"近1年","6m":"近6月","3m":"近3月","1m":"近1月"}[t]||t,value:m.fundReturn}}return{label:"近1年",value:0}});function G(){K.back()}function A(){const i=ee.watchlist,t=i.findIndex(m=>m.code===v.value);t>0?K.replace(`/detail/${i[t-1].code}`):de("已是第一只")}function p(){const i=ee.watchlist,t=i.findIndex(m=>m.code===v.value);t>=0&&t<i.length-1?K.replace(`/detail/${i[t+1].code}`):de("已是最后一只")}function d(){K.push("/search")}function X(){K.push("/holding")}function D(){K.push("/alerts")}function oe(){K.push(`/trades/${v.value}`)}async function U(){if(!ee.isFundInWatchlist(v.value)){de("不在自选中");return}try{await _t({title:"删除自选",message:`确定将 ${y.value?.name||"该基金"} 从自选中删除？`}),await ee.removeFund(v.value),de("已删除")}catch{}}async function ie(){if(ee.isFundInWatchlist(v.value)){de("已在自选中");return}await ee.addFund(v.value,y.value?.name||""),de("添加成功")}function ge(){de("更多功能开发中")}function ce(i){if(i===v.value){de("已在当前基金");return}K.push(`/detail/${i}`)}function Me(){V.value&&K.push(`/search?q=${encodeURIComponent(V.value.name)}`)}const fe=j(()=>{if(!W.value||!f.value)return null;const i=f.value.holdDays,t=f.value.amount;return it(i,t,W.value.redemptionFees)}),ke=j(()=>te.value.reduce((i,t)=>i+t.amount,0)),we=j(()=>{const i=re.value.reduce((R,J)=>R+J.ratio,0);if(i===0)return[];const t=2*Math.PI*40;let m=0;return re.value.map(R=>{const J=R.ratio/i,l=t*J,C=`${l} ${t-l}`,u=-m;return m+=l,{...R,dashArray:C,offset:u}})});function Ae(i){i?window.open(i,"_blank"):de("暂无详情链接")}function ue(i,t=2){return Math.abs(i)>=1e4?(i/1e4).toFixed(2)+"万":i.toFixed(t)}function E(i){return`${i>=0?"+":""}${i.toFixed(2)}%`}return(i,t)=>{const m=lt,R=He,J=ct;return n(),o("div",Et,[e("div",Nt,[e("div",Ot,[z(m,{name:"arrow-left",size:"22",color:"var(--text-primary)",onClick:G}),z(m,{name:"arrow-left",size:"18",color:"var(--text-secondary)",onClick:A}),e("div",Bt,[e("div",Ht,a(y.value?.name||"加载中..."),1),e("div",Xt,a(v.value),1)]),z(m,{name:"arrow",size:"18",color:"var(--text-secondary)",onClick:p}),z(m,{name:"search",size:"22",color:"var(--text-primary)",onClick:d})]),he.value?(n(),o("div",ts,[z(R,{color:"var(--text-secondary)"})])):(n(),o("div",jt,[e("div",Yt,[e("div",Ut,"当日涨幅 "+a(y.value?.gztime?.slice(5,10)||"--"),1),e("div",{class:k(["change-value",b.value?"up":"down"])},a(E(r.value)),3)]),e("div",Kt,[e("div",qt,[t[5]||(t[5]=e("div",{class:"metric-label"},"估算净值",-1)),e("div",Gt,a(y.value?.gsz||"--"),1)]),e("div",Jt,[t[6]||(t[6]=e("div",{class:"metric-label"},"昨日净值",-1)),e("div",Qt,a(y.value?.dwjz||"--"),1)]),e("div",Zt,[e("div",es,a(L.value.label),1),e("div",{class:k(["metric-value",L.value.value>=0?"up":"down"])},a(L.value.value!==0?E(L.value.value):"--"),3)])])]))]),f.value?(n(),o("div",{key:0,class:k(["holding-panel",{collapsed:!pe.value}])},[e("div",{class:"holding-summary",onClick:t[0]||(t[0]=l=>pe.value=!pe.value)},[e("div",ss,[t[7]||(t[7]=e("span",{class:"summary-label"},"持有金额",-1)),e("span",as,a(ue(f.value.amount)),1)]),e("div",ls,[t[8]||(t[8]=e("span",{class:"summary-label"},"持有收益",-1)),e("span",{class:k(["summary-value",f.value.profit>=0?"up":"down"])},a(ue(f.value.profit)),3)]),e("div",ns,[t[9]||(t[9]=e("span",{class:"summary-label"},"收益率",-1)),e("span",{class:k(["summary-value",f.value.profitRate>=0?"up":"down"])},a(E(f.value.profitRate)),3)]),z(m,{name:pe.value?"arrow-up":"arrow-down",class:"expand-icon"},null,8,["name"])]),z(at,{name:"slide"},{default:Xe(()=>[Re(e("div",os,[e("div",is,[t[10]||(t[10]=e("div",{class:"item-label"},"持有金额",-1)),e("div",cs,a(ue(f.value.amount)),1)]),e("div",ds,[t[11]||(t[11]=e("div",{class:"item-label"},"持有份额",-1)),e("div",rs,a(ue(f.value.shares)),1)]),e("div",us,[t[12]||(t[12]=e("div",{class:"item-label"},"持仓占比",-1)),e("div",vs,a(f.value.ratio.toFixed(2))+"%",1)]),e("div",ms,[t[13]||(t[13]=e("div",{class:"item-label"},"持有收益",-1)),e("div",{class:k(["item-value",f.value.profit>=0?"up":"down"])},a(ue(f.value.profit)),3)]),e("div",hs,[t[14]||(t[14]=e("div",{class:"item-label"},"持有收益率",-1)),e("div",{class:k(["item-value",f.value.profitRate>=0?"up":"down"])},a(E(f.value.profitRate)),3)]),e("div",ps,[t[15]||(t[15]=e("div",{class:"item-label"},"持仓成本",-1)),e("div",fs,a(f.value.cost.toFixed(4)),1)]),e("div",gs,[t[16]||(t[16]=e("div",{class:"item-label"},"当日收益",-1)),e("div",{class:k(["item-value",f.value.todayProfit>=0?"up":"down"])},a(ue(f.value.todayProfit)),3)]),e("div",_s,[t[17]||(t[17]=e("div",{class:"item-label"},"昨日收益",-1)),e("div",{class:k(["item-value",f.value.yesterdayProfit>=0?"up":"down"])},a(ue(f.value.yesterdayProfit)),3)]),e("div",ys,[t[18]||(t[18]=e("div",{class:"item-label"},"持有天数",-1)),e("div",bs,a(f.value.holdDays),1)])],512),[[ze,pe.value]])]),_:1})],2)):P("",!0),e("div",xs,[e("div",{class:k(["tab-item",{active:se.value==="chart"}]),onClick:t[1]||(t[1]=l=>se.value="chart")}," 关联涨幅 ",2),e("div",{class:k(["tab-item",{active:se.value==="performance"}]),onClick:t[2]||(t[2]=l=>se.value="performance")}," 业绩走势 ",2),e("div",{class:k(["tab-item",{active:se.value==="profit"}]),onClick:t[3]||(t[3]=l=>se.value="profit")}," 我的收益 ",2)]),Re(e("div",ks,[e("div",ws,[e("span",null,a(y.value?.gztime?.slice(5,10)||"--"),1),e("span",{class:k(["estimate-tag",b.value?"up":"down"])}," 估算涨幅 "+a(E(r.value)),3),e("span",Cs,[z(m,{name:"replay"}),t[19]||(t[19]=Se(" 数据源1 ",-1))])]),z(Lt,{"fund-code":v.value,"realtime-value":y.value?.gsz?parseFloat(y.value.gsz):0,"realtime-change":r.value,"last-close":y.value?.dwjz?parseFloat(y.value.dwjz):0},null,8,["fund-code","realtime-value","realtime-change","last-close"])],512),[[ze,se.value==="chart"]]),Re(e("div",Fs,[ae.value.length>0?(n(),o("div",Ss,[(n(!0),o(Q,null,Z(ae.value.slice(0,6),l=>(n(),o("div",{key:l.period,class:"period-item"},[e("div",$s,a(l.label),1),e("div",{class:k(["period-return",l.fundReturn>=0?"up":"down"])},a(E(l.fundReturn)),3),l.rank>0?(n(),o("div",Ds,[e("span",Ts,a(l.rank),1),Se("/"+a(l.totalCount),1)])):P("",!0)]))),128))])):(n(),We(J,{key:1,description:"暂无业绩数据"}))],512),[[ze,se.value==="performance"]]),Re(e("div",Ps,[f.value?(n(),o("div",Rs,[e("div",zs,[e("div",Ms,[t[20]||(t[20]=e("span",{class:"label"},"累计收益",-1)),e("span",{class:k(["value",f.value.profit>=0?"up":"down"])},a(ue(f.value.profit)),3)]),e("div",As,[t[21]||(t[21]=e("span",{class:"label"},"收益率",-1)),e("span",{class:k(["value",f.value.profitRate>=0?"up":"down"])},a(E(f.value.profitRate)),3)])])])):(n(),We(J,{key:1,description:"暂未持有该基金"}))],512),[[ze,se.value==="profit"]]),V.value?(n(),o("div",{key:1,class:"sector-section",onClick:Me},[e("div",Is,[t[22]||(t[22]=e("span",{class:"sector-label"},"关联板块：",-1)),e("span",Vs,a(V.value.name),1),e("span",{class:k(["sector-change",V.value.dayReturn>=0?"up":"down"])},a(E(V.value.dayReturn)),3)]),e("div",Ws,[Se(a(O.value.length)+"只同类基金 ",1),z(m,{name:"arrow"})])])):P("",!0),O.value.length>0?(n(),o("div",Ls,[t[23]||(t[23]=e("div",{class:"section-header"},[e("span",null,"同类基金"),e("span",{class:"section-tip"},"年涨幅TOP5")],-1)),e("div",Es,[(n(!0),o(Q,null,Z(O.value.slice(0,5),l=>(n(),o("div",{key:l.code,class:"similar-item",onClick:C=>ce(l.code)},[e("div",Os,[e("div",Bs,a(l.name),1),e("div",Hs,a(l.code),1)]),e("div",{class:k(["similar-return",l.yearReturn>=0?"up":"down"])},a(E(l.yearReturn)),3)],8,Ns))),128))])])):P("",!0),B.value&&B.value.scale>0?(n(),o("div",Xs,[e("div",js,[t[24]||(t[24]=e("span",null,"基金规模",-1)),e("span",Ys,a(B.value.scaleDate),1)]),e("div",Us,[e("div",Ks,[e("div",qs,a(B.value.scale.toFixed(2))+"亿",1),t[25]||(t[25]=e("div",{class:"scale-label"},"资产规模",-1))]),e("div",Gs,[e("div",Js,a(B.value.shareTotal.toFixed(2))+"亿份",1),t[26]||(t[26]=e("div",{class:"scale-label"},"总份额",-1))]),e("div",Qs,[e("div",Zs,a(B.value.institutionRatio.toFixed(1))+"%",1),t[27]||(t[27]=e("div",{class:"scale-label"},"机构持有",-1))]),e("div",ea,[e("div",ta,a(B.value.personalRatio.toFixed(1))+"%",1),t[28]||(t[28]=e("div",{class:"scale-label"},"个人持有",-1))])])])):P("",!0),W.value?(n(),o("div",sa,[t[37]||(t[37]=e("div",{class:"section-header"},[e("span",null,"费率信息")],-1)),e("div",aa,[e("div",la,[t[29]||(t[29]=e("div",{class:"fee-label"},"管理费",-1)),e("div",na,a(W.value.managementFee.toFixed(2))+"%/年",1)]),e("div",oa,[t[30]||(t[30]=e("div",{class:"fee-label"},"托管费",-1)),e("div",ia,a(W.value.custodianFee.toFixed(2))+"%/年",1)]),W.value.salesServiceFee>0?(n(),o("div",ca,[t[31]||(t[31]=e("div",{class:"fee-label"},"销售服务费",-1)),e("div",da,a(W.value.salesServiceFee.toFixed(2))+"%/年",1)])):P("",!0)]),e("div",ra,[t[32]||(t[32]=e("div",{class:"table-title"},"申购费率",-1)),t[33]||(t[33]=e("div",{class:"table-row header"},[e("span",null,"金额"),e("span",null,"原费率"),e("span",null,"优惠费率")],-1)),(n(!0),o(Q,null,Z(W.value.purchaseFees.slice(0,4),(l,C)=>(n(),o("div",{key:"p"+C,class:"table-row"},[e("span",null,a(l.minAmount===0&&l.maxAmount===1/0?"全部金额":l.maxAmount===1/0?`≥${l.minAmount}万`:l.minAmount===0?`<${l.maxAmount}万`:`${l.minAmount}-${l.maxAmount}万`),1),e("span",null,a(l.rate>=1e3?`${l.rate}元`:l.rate===0?"免费":`${l.rate}%`),1),e("span",ua,a(l.discountRate>=1e3?`${l.discountRate}元`:l.discountRate===0?"免费":`${l.discountRate}%`),1)]))),128))]),e("div",va,[t[34]||(t[34]=e("div",{class:"table-title"},"赎回费率",-1)),t[35]||(t[35]=e("div",{class:"table-row header"},[e("span",null,"持有期限"),e("span",null,"费率")],-1)),(n(!0),o(Q,null,Z(W.value.redemptionFees,(l,C)=>(n(),o("div",{key:"r"+C,class:"table-row"},[e("span",null,a(l.maxDays===1/0?`≥${l.minDays}天`:l.minDays===0?`<${l.maxDays}天`:`${l.minDays}-${l.maxDays}天`),1),e("span",{class:k({free:l.rate===0})},a(l.rate===0?"免费":`${l.rate}%`),3)]))),128))]),fe.value&&f.value?(n(),o("div",ma,[e("div",ha,[e("span",null,"当前持有 "+a(f.value.holdDays)+" 天，赎回费率 "+a(fe.value.rate)+"%",1)]),e("div",pa,[t[36]||(t[36]=Se(" 预估赎回费: ",-1)),e("span",fa,"¥"+a(fe.value.fee.toFixed(2)),1)])])):P("",!0)])):P("",!0),e("div",ga,[e("div",_a,[t[38]||(t[38]=e("span",null,"重仓股票",-1)),q.value.length>0?(n(),o("span",ya," TOP"+a(q.value.length),1)):P("",!0)]),q.value.length>0?(n(),o("div",ba,[(n(!0),o(Q,null,Z(q.value,(l,C)=>(n(),o("div",{key:C,class:"holding-item"},[e("div",xa,a(C+1),1),e("div",ka,[e("div",wa,a(l.stockName),1),e("div",Ca,a(l.stockCode),1)]),e("div",Fa,[e("div",Sa,a(l.holdingRatio.toFixed(2))+"%",1),t[39]||(t[39]=e("div",{class:"ratio-label"},"持仓占比",-1))])]))),128))])):(n(),o("div",$a,"暂无持仓数据"))]),re.value.length>0?(n(),o("div",Da,[t[40]||(t[40]=e("div",{class:"section-header"},[e("span",null,"行业配置")],-1)),e("div",Ta,[e("div",Pa,[(n(),o("svg",Ra,[(n(!0),o(Q,null,Z(we.value,(l,C)=>(n(),o("circle",{key:C,cx:"50",cy:"50",r:"40",fill:"transparent",stroke:l.color,"stroke-width":"20","stroke-dasharray":l.dashArray,"stroke-dashoffset":l.offset,style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"}},null,8,za))),128))]))]),e("div",Ma,[(n(!0),o(Q,null,Z(re.value.slice(0,6),l=>(n(),o("div",{key:l.name,class:"legend-item"},[e("span",{class:"legend-color",style:Fe({background:l.color})},null,4),e("span",Aa,a(l.name),1),e("span",Ia,a(l.ratio)+"%",1)]))),128))])])])):P("",!0),M.value?(n(),o("div",Va,[t[45]||(t[45]=e("div",{class:"section-header"},[e("span",null,"资产配置")],-1)),e("div",Wa,[M.value.stock>0?(n(),o("div",La,[t[41]||(t[41]=e("span",{class:"asset-label"},"股票",-1)),e("div",Ea,[e("div",{class:"bar-fill stock",style:Fe({width:M.value.stock+"%"})},null,4)]),e("span",Na,a(M.value.stock)+"%",1)])):P("",!0),M.value.bond>0?(n(),o("div",Oa,[t[42]||(t[42]=e("span",{class:"asset-label"},"债券",-1)),e("div",Ba,[e("div",{class:"bar-fill bond",style:Fe({width:M.value.bond+"%"})},null,4)]),e("span",Ha,a(M.value.bond)+"%",1)])):P("",!0),M.value.cash>0?(n(),o("div",Xa,[t[43]||(t[43]=e("span",{class:"asset-label"},"现金",-1)),e("div",ja,[e("div",{class:"bar-fill cash",style:Fe({width:M.value.cash+"%"})},null,4)]),e("span",Ya,a(M.value.cash)+"%",1)])):P("",!0),M.value.other>0?(n(),o("div",Ua,[t[44]||(t[44]=e("span",{class:"asset-label"},"其他",-1)),e("div",Ka,[e("div",{class:"bar-fill other",style:Fe({width:M.value.other+"%"})},null,4)]),e("span",qa,a(M.value.other)+"%",1)])):P("",!0)])])):P("",!0),H.value?(n(),o("div",Ga,[e("div",Ja,[t[46]||(t[46]=e("span",null,"基金评级",-1)),e("span",Qa,a(H.value.riskLevel),1)]),e("div",Za,[e("div",el,[(n(),o(Q,null,Z(5,l=>z(m,{key:l,name:l<=H.value.rating?"star":"star-o",color:l<=H.value.rating?"#f59e0b":"#d1d5db",size:"20"},null,8,["name","color"])),64)),e("span",tl,a(H.value.rating)+"星",1)]),e("div",sl,[e("div",al,[e("div",ll,a(H.value.sharpeRatio||"--"),1),t[47]||(t[47]=e("div",{class:"metric-label"},"夏普比率",-1))]),e("div",nl,[e("div",ol,a(H.value.maxDrawdown?H.value.maxDrawdown+"%":"--"),1),t[48]||(t[48]=e("div",{class:"metric-label"},"最大回撤",-1))]),e("div",il,[e("div",cl,a(H.value.volatility?H.value.volatility+"%":"--"),1),t[49]||(t[49]=e("div",{class:"metric-label"},"波动率",-1))]),e("div",dl,[e("div",rl,a(H.value.rankInSimilar),1),t[50]||(t[50]=e("div",{class:"metric-label"},"同类排名",-1))])])])])):P("",!0),e("div",ul,[e("div",vl,[t[51]||(t[51]=e("span",null,"分红记录",-1)),te.value.length>0?(n(),o("span",ml," 累计"+a(te.value.length)+"次，共"+a(ke.value.toFixed(4))+"元/份 ",1)):P("",!0)]),te.value.length>0?(n(),o("div",hl,[(n(!0),o(Q,null,Z(te.value.slice(0,5),(l,C)=>(n(),o("div",{key:C,class:"dividend-item"},[e("div",pl,a(l.date),1),e("div",fl,"每份派"+a(l.amount.toFixed(4))+"元",1),e("div",gl,a(l.type),1)]))),128)),te.value.length>5?(n(),o("div",_l," 还有"+a(te.value.length-5)+"条记录... ",1)):P("",!0)])):(n(),o("div",yl,"暂无分红记录"))]),e("div",bl,[t[52]||(t[52]=e("div",{class:"section-header"},[e("span",null,"基金公告")],-1)),ne.value.length>0?(n(),o("div",xl,[(n(!0),o(Q,null,Z(ne.value.slice(0,5),l=>(n(),o("div",{key:l.id,class:"announcement-item",onClick:C=>Ae(l.url)},[e("div",{class:k(["announcement-type",l.type])},a(l.type==="分红公告"?"分红":l.type==="定期报告"?"报告":l.type==="人事变动"?"人事":"公告"),3),e("div",wl,[e("div",Cl,a(l.title),1),e("div",Fl,a(l.date),1)]),z(m,{name:"arrow",class:"announcement-arrow"})],8,kl))),128))])):(n(),o("div",Sl,"暂无公告"))]),e("div",$l,[e("div",{class:"bar-item",onClick:X},[z(m,{name:"edit",size:"20"}),t[53]||(t[53]=e("span",null,"修改持仓",-1))]),e("div",{class:"bar-item",onClick:D},[z(m,{name:"bell",size:"20"}),t[54]||(t[54]=e("span",null,"提醒",-1))]),e("div",{class:"bar-item",onClick:oe},[z(m,{name:"orders-o",size:"20"}),t[55]||(t[55]=e("span",null,"交易记录",-1))]),e("div",{class:"bar-item",onClick:t[4]||(t[4]=l=>Ve(ee).isFundInWatchlist(v.value)?U():ie())},[z(m,{name:Ve(ee).isFundInWatchlist(v.value)?"star":"star-o",size:"20"},null,8,["name"]),e("span",null,a(Ve(ee).isFundInWatchlist(v.value)?"删自选":"加自选"),1)]),e("div",{class:"bar-item",onClick:ge},[z(m,{name:"ellipsis",size:"20"}),t[56]||(t[56]=e("span",null,"更多",-1))])])])}}}),Nl=je(Dl,[["__scopeId","data-v-8bca81e9"]]);export{Nl as default};
