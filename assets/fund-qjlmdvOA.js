import{I as w,r as l,p as y}from"./index-COLuSNnH.js";import{fetchFundEstimateFast as m}from"./fundFast-BTB3GdVE.js";import{a as z,i as W,b as I,c as x}from"./storage-BvZjhTaj.js";const E=w("fund",()=>{const n=l([]),s=l(!1),u=l(""),o=y(()=>n.value.map(e=>e.code));function h(){const e=z();n.value=e.map(t=>({code:t,name:"",loading:!0})),e.length>0&&c()}async function c(){if(n.value.length===0){s.value=!1;return}s.value=!0;const e=n.value.map(t=>t.code);try{(await Promise.all(e.map(a=>m(a).catch(()=>null)))).forEach((a,i)=>{if(a)f(e[i],a);else{const d=n.value.find(F=>F.code===e[i]);d&&(d.loading=!1)}}),u.value=new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}finally{s.value=!1}}async function r(e){try{const t=await m(e);f(e,t)}catch{}}function f(e,t){const a=n.value.findIndex(i=>i.code===e);a>-1&&(n.value[a]={code:t.fundcode,name:t.name,estimateValue:t.gsz,estimateChange:t.gszzl,estimateTime:t.gztime,lastValue:t.dwjz,loading:!1})}async function v(e,t){return W(e)?!1:(I(e),n.value.unshift({code:e,name:t,loading:!0}),await r(e),!0)}function g(e){x(e);const t=n.value.findIndex(a=>a.code===e);t>-1&&n.value.splice(t,1)}function p(e){return o.value.includes(e)}return{watchlist:n,isRefreshing:s,lastRefreshTime:u,watchlistCodes:o,initWatchlist:h,refreshEstimates:c,refreshSingleFund:r,addFund:v,removeFund:g,isFundInWatchlist:p}});export{E as u};
