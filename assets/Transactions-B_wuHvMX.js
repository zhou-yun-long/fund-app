import{d as M,o as E,R as h,k,M as s,N as i,O as c,U as J,V as L,K as C,T as O,r as S,p,J as f,L as $,W as R,as as q,a3 as z,_ as H}from"./index-COLuSNnH.js";import{E as K}from"./index-7ADYuEsa.js";import{S as U}from"./index-DhMkXSC4.js";/* empty css              *//* empty css              */import{N as W}from"./index-DtBFF6eJ.js";import{u as Y}from"./holding-Cj-ioGV6.js";import{B as j}from"./index-dROw2vyl.js";import{s as G}from"./function-call-fsbkCKQc.js";import"./use-id-Bb8U-BO_.js";import"./storage-BvZjhTaj.js";import"./fundFast-BTB3GdVE.js";import"./fund-BsJItZTy.js";const P={class:"transactions-page"},Q={class:"stats-card"},X={class:"stats-row"},Z={class:"stats-item"},tt={class:"stats-value buy"},et={class:"stats-item"},st={class:"stats-value sell"},at={class:"stats-item"},ot={class:"stats-value dividend"},nt={class:"stats-summary"},it={class:"filter-bar"},lt={class:"transaction-list"},rt=["onClick"],dt={class:"item-left"},ct={class:"item-info"},ut={class:"item-name"},vt={class:"item-meta"},ft={class:"item-right"},mt={class:"item-detail"},_t=M({__name:"Transactions",setup(pt){const w=q(),y=R(),x=Y(),v=p(()=>w.params.code||""),l=S([]),r=S("all");E(()=>{N()});function N(){const t=localStorage.getItem("fund_transactions");if(t)try{l.value=JSON.parse(t)}catch{l.value=[]}l.value.length===0&&(x.holdings.forEach(o=>{l.value.push({id:`buy_${o.code}_${o.createdAt}`,code:o.code,name:o.name,type:"buy",amount:o.amount,shares:o.shares,netValue:o.buyNetValue,fee:o.buyFeeAmount||0,date:o.buyDate,createdAt:o.createdAt})}),g())}function g(){localStorage.setItem("fund_transactions",JSON.stringify(l.value))}const b=p(()=>{let t=l.value;return v.value&&(t=t.filter(e=>e.code===v.value)),r.value!=="all"&&(t=t.filter(e=>e.type===r.value)),t.sort((e,o)=>o.createdAt-e.createdAt)}),u=p(()=>{const t=v.value?l.value.filter(n=>n.code===v.value):l.value,e=t.filter(n=>n.type==="buy").reduce((n,a)=>n+a.amount,0),o=t.filter(n=>n.type==="sell").reduce((n,a)=>n+a.amount,0),m=t.filter(n=>n.type==="dividend").reduce((n,a)=>n+a.amount,0),_=t.reduce((n,a)=>n+a.fee,0);return{buyTotal:e,sellTotal:o,dividendTotal:m,feeTotal:_,netInvest:e-o}});function B(t){return{buy:"买入",sell:"卖出",dividend:"分红",auto_invest:"定投"}[t]||t}function T(t){return t==="buy"||t==="auto_invest"?"buy":t==="sell"?"sell":t==="dividend"?"dividend":""}function D(t){if(!t)return"--";const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function d(t){return Math.abs(t)>=1e4?(t/1e4).toFixed(2)+"万":t.toFixed(2)}async function F(t){try{await G({title:"删除记录",message:"确定删除这条交易记录？"}),l.value=l.value.filter(e=>e.id!==t),g(),z("已删除")}catch{}}function V(){y.back()}function A(t){y.push(`/detail/${t}`)}return(t,e)=>{const o=W,m=j,_=U,n=K;return f(),h("div",P,[k(o,{title:"交易记录","left-arrow":"",onClickLeft:V}),s("div",Q,[s("div",X,[s("div",Z,[e[4]||(e[4]=s("div",{class:"stats-label"},"累计买入",-1)),s("div",tt,"¥"+i(d(u.value.buyTotal)),1)]),s("div",et,[e[5]||(e[5]=s("div",{class:"stats-label"},"累计卖出",-1)),s("div",st,"¥"+i(d(u.value.sellTotal)),1)]),s("div",at,[e[6]||(e[6]=s("div",{class:"stats-label"},"累计分红",-1)),s("div",ot,"¥"+i(d(u.value.dividendTotal)),1)])]),s("div",nt,[s("span",null,"净投入：¥"+i(d(u.value.netInvest)),1),s("span",null,"手续费：¥"+i(d(u.value.feeTotal)),1)])]),s("div",it,[s("div",{class:c(["filter-item",{active:r.value==="all"}]),onClick:e[0]||(e[0]=a=>r.value="all")}," 全部 ",2),s("div",{class:c(["filter-item",{active:r.value==="buy"}]),onClick:e[1]||(e[1]=a=>r.value="buy")}," 买入 ",2),s("div",{class:c(["filter-item",{active:r.value==="sell"}]),onClick:e[2]||(e[2]=a=>r.value="sell")}," 卖出 ",2),s("div",{class:c(["filter-item",{active:r.value==="dividend"}]),onClick:e[3]||(e[3]=a=>r.value="dividend")}," 分红 ",2)]),s("div",lt,[(f(!0),h(J,null,L(b.value,a=>(f(),C(_,{key:a.id},{right:$(()=>[k(m,{square:"",type:"danger",text:"删除",class:"delete-btn",onClick:I=>F(a.id)},null,8,["onClick"])]),default:$(()=>[s("div",{class:"transaction-item",onClick:I=>A(a.code)},[s("div",dt,[s("div",{class:c(["type-tag",T(a.type)])},i(B(a.type)),3),s("div",ct,[s("div",ut,i(a.name),1),s("div",vt,i(a.code)+" · "+i(D(a.date)),1)])]),s("div",ft,[s("div",{class:c(["item-amount",T(a.type)])},i(a.type==="sell"?"+":"-")+"¥"+i(d(a.amount)),3),s("div",mt,i(a.shares.toFixed(2))+"份 @ "+i(a.netValue.toFixed(4)),1)])],8,rt)]),_:2},1024))),128)),b.value.length===0?(f(),C(n,{key:0,description:"暂无交易记录"})):O("",!0)])])}}}),Dt=H(_t,[["__scopeId","data-v-40eadbfa"]]);export{Dt as default};
