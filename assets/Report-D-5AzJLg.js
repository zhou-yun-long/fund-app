import{d as O,o as U,v as T,R as W,k as $,S as G,M as p,O as x,L as P,W as J,r as _,J as j,$ as A,ad as V,a3 as C,ae as E,_ as K}from"./index-COLuSNnH.js";/* empty css              *//* empty css              */import{N as Q}from"./index-DtBFF6eJ.js";import{u as X}from"./holding-Cj-ioGV6.js";import{u as Z}from"./trade-CO69ODrI.js";import{B as tt}from"./index-dROw2vyl.js";import"./storage-BvZjhTaj.js";import"./fundFast-BTB3GdVE.js";import"./fund-BsJItZTy.js";const et={class:"report-page"},at={class:"type-bar"},ot={class:"report-preview"},lt={class:"action-bar"},nt=O({__name:"Report",setup(rt){const F=J(),v=X(),M=Z(),u=_("monthly"),f=_(null),d=_(null);function B(e){const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate());let o,r;switch(e){case"weekly":o=new Date(a),o.setDate(o.getDate()-7),r="周报";break;case"monthly":o=new Date(a),o.setMonth(o.getMonth()-1),r="月报";break;case"yearly":o=new Date(a),o.setFullYear(o.getFullYear()-1),r="年报";break}return{start:o,end:a,label:r}}function D(e){return`${e.getFullYear()}.${(e.getMonth()+1).toString().padStart(2,"0")}.${e.getDate().toString().padStart(2,"0")}`}function R(){const{start:e,end:t,label:a}=B(u.value),o=v.summary,r=M.trades.filter(n=>{const c=new Date(n.date);return c>=e&&c<=t});let l=0,s=0;r.forEach(n=>{n.type==="buy"?l+=n.amount:n.type==="sell"&&(s+=n.amount)});const m=v.holdings.filter(n=>n.marketValue!==void 0&&n.marketValue>0).sort((n,c)=>(c.marketValue||0)-(n.marketValue||0)).slice(0,5).map(n=>({name:n.name||n.code,value:n.marketValue||0,profit:n.profit||0,rate:n.profitRate||0}));d.value={period:a,periodStart:D(e),periodEnd:D(t),totalValue:o.totalValue,totalCost:o.totalCost,totalProfit:o.totalProfit,profitRate:o.totalProfitRate,todayProfit:o.todayProfit,holdingCount:v.holdings.length,tradeCount:r.length,buyAmount:l,sellAmount:s,topHoldings:m}}async function y(){if(!f.value||!d.value)return;const e=f.value,t=e.getContext("2d");if(!t)return;const a=window.devicePixelRatio||2,o=375*a,r=600*a;e.width=o,e.height=r,t.scale(a,a);const l=d.value,s=375,m=600,n=t.createLinearGradient(0,0,0,m);n.addColorStop(0,"#1a1a2e"),n.addColorStop(1,"#16213e"),t.fillStyle=n,t.fillRect(0,0,s,m),t.fillStyle="#fff",t.font="bold 24px -apple-system, sans-serif",t.textAlign="center",t.fillText(`投资${l.period}`,s/2,50),t.fillStyle="rgba(255,255,255,0.6)",t.font="14px -apple-system, sans-serif",t.fillText(`${l.periodStart} - ${l.periodEnd}`,s/2,75),t.fillStyle="rgba(255,255,255,0.08)",N(t,20,100,s-40,120,12),t.fill(),t.fillStyle="rgba(255,255,255,0.6)",t.font="13px -apple-system, sans-serif",t.textAlign="left",t.fillText("总资产(元)",40,130),t.fillStyle="#fff",t.font="bold 32px -apple-system, sans-serif",t.fillText(b(l.totalValue),40,170);const c=l.totalProfit>=0?"#0ecb81":"#f6465d";t.fillStyle=c,t.font="bold 18px -apple-system, sans-serif";const H=`${l.totalProfit>=0?"+":""}${b(l.totalProfit)} (${l.profitRate>=0?"+":""}${l.profitRate.toFixed(2)}%)`;t.fillText(H,40,205);const Y=250,q=[{label:"持仓数",value:`${l.holdingCount}只`},{label:"交易次数",value:`${l.tradeCount}次`},{label:"买入",value:`¥${b(l.buyAmount)}`},{label:"卖出",value:`¥${b(l.sellAmount)}`}],I=(s-60)/2;q.forEach((i,w)=>{const g=30+w%2*I,S=Y+Math.floor(w/2)*55;t.fillStyle="rgba(255,255,255,0.6)",t.font="12px -apple-system, sans-serif",t.textAlign="left",t.fillText(i.label,g,S),t.fillStyle="#fff",t.font="bold 16px -apple-system, sans-serif",t.fillText(i.value,g,S+22)}),l.topHoldings.length>0&&(t.fillStyle="rgba(255,255,255,0.6)",t.font="13px -apple-system, sans-serif",t.textAlign="left",t.fillText("持仓TOP5",30,380),l.topHoldings.forEach((i,w)=>{const g=405+w*35;t.fillStyle="#fff",t.font="14px -apple-system, sans-serif",t.textAlign="left";const S=i.name.length>10?i.name.slice(0,10)+"...":i.name;t.fillText(S,30,g);const z=i.rate>=0?"#0ecb81":"#f6465d";t.fillStyle=z,t.font="bold 14px -apple-system, sans-serif",t.textAlign="right",t.fillText(`${i.rate>=0?"+":""}${i.rate.toFixed(2)}%`,s-30,g)})),t.fillStyle="rgba(255,255,255,0.3)",t.font="11px -apple-system, sans-serif",t.textAlign="center",t.fillText("基金估值助手 · 投资有风险",s/2,m-30)}function N(e,t,a,o,r,l){e.beginPath(),e.moveTo(t+l,a),e.lineTo(t+o-l,a),e.quadraticCurveTo(t+o,a,t+o,a+l),e.lineTo(t+o,a+r-l),e.quadraticCurveTo(t+o,a+r,t+o-l,a+r),e.lineTo(t+l,a+r),e.quadraticCurveTo(t,a+r,t,a+r-l),e.lineTo(t,a+l),e.quadraticCurveTo(t,a,t+l,a),e.closePath()}function b(e){return e.toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2})}async function h(){if(f.value){V({message:"生成中...",duration:0});try{await T(),await y();const e=f.value.toDataURL("image/png"),t=document.createElement("a");t.download=`投资报告_${d.value?.periodStart}_${d.value?.periodEnd}.png`,t.href=e,t.click(),C("已保存到相册")}catch(e){console.error("保存失败:",e),C("保存失败")}finally{E()}}}async function L(){if(f.value){V({message:"生成中...",duration:0});try{await T(),await y();const e=await new Promise((t,a)=>{f.value.toBlob(o=>{o?t(o):a(new Error("生成图片失败"))},"image/png")});if(navigator.share&&navigator.canShare){const a={files:[new File([e],"report.png",{type:"image/png"})]};if(navigator.canShare(a)){await navigator.share(a),C("分享成功");return}}h()}catch(e){e.name!=="AbortError"&&(console.error("分享失败:",e),C("分享失败，已保存到本地"),h())}finally{E()}}}function k(e){u.value=e,R(),T(()=>y())}return U(async()=>{await v.initHoldings(),R(),await T(),y()}),(e,t)=>{const a=Q,o=tt;return j(),W("div",et,[$(a,{title:"收益报告","left-arrow":"",onClickLeft:t[0]||(t[0]=r=>G(F).back())}),p("div",at,[p("span",{class:x(["type-btn",{active:u.value==="weekly"}]),onClick:t[1]||(t[1]=r=>k("weekly"))},"周报",2),p("span",{class:x(["type-btn",{active:u.value==="monthly"}]),onClick:t[2]||(t[2]=r=>k("monthly"))},"月报",2),p("span",{class:x(["type-btn",{active:u.value==="yearly"}]),onClick:t[3]||(t[3]=r=>k("yearly"))},"年报",2)]),p("div",ot,[p("canvas",{ref_key:"reportCanvas",ref:f,class:"report-canvas"},null,512)]),p("div",lt,[$(o,{type:"primary",icon:"share-o",onClick:L},{default:P(()=>[...t[4]||(t[4]=[A(" 分享报告 ",-1)])]),_:1}),$(o,{icon:"down",onClick:h},{default:P(()=>[...t[5]||(t[5]=[A(" 保存图片 ",-1)])]),_:1})])])}}}),yt=K(nt,[["__scopeId","data-v-0ddbe9b0"]]);export{yt as default};
